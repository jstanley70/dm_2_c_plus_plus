//C_ElasticConstants.c/*  ElasticConstants.c -- This file will calculate the image plane.  Thanx to 	ImageIt for the	dialog boxes	*/	#include	"Diffract_INCs.h"#include  	"ElasticConstant.h"#define 	ELASTIC_DLOG  11119Boolean ElasticConstant::DoInit(Crystal *aCrystal){		theCrystal = (Crystal*)D_new(Crystal);	theCrystal->InitCrystal(0);	aCrystal->CopyCrystal(theCrystal);	originalCrystal = aCrystal;	lattice_Type = theCrystal->lattice_Type;	return true;}void ElasticConstant::DoClose(void){		theCrystal->DoClose();		D_delete(this);		return;}void ElasticConstant::DoCopy(Crystal *aCrystal){	short i;	for(i=0;i<=20;i++){		if(fabs(aCrystal->elasticConstants[i] - theCrystal->elasticConstants[i]) > .0001)gCurrentObj->changedFlag = true;		aCrystal->elasticConstants[i] = theCrystal->elasticConstants[i];	}	return;	}void ElasticConstant::EnableDisableItems(DialogPtr theDialog){							char 	theText[25];	short 	pointGrp;	short	i;	pointGrp = theCrystal->GetPointGrp();	switch(pointGrp){		case 1:		case 2:			sprintf(gTheText,"Crystal Family = Triclinic, Point Grp. = ");			break;		case 3:		case 4:		case 5:			StatTextItem(theDialog,_6_,true);			StatTextItem(theDialog,_8_,true);			StatTextItem(theDialog,_11_,true);			StatTextItem(theDialog,_13_,true);			StatTextItem(theDialog,_15_,true);			StatTextItem(theDialog,_17_,true);			StatTextItem(theDialog,_19_,true);			StatTextItem(theDialog,_22_,true);						sprintf(gTheText,"Crystal Family = Monoclinic, Point Grp. = ");								break;		case 6:		case 7:		case 8:			for(i=_6_;i<=_8_;i++) 	StatTextItem(theDialog,i,true);			for(i=_11_;i<=_13_;i++) StatTextItem(theDialog,i,true);			for(i=_15_;i<=_17_;i++) StatTextItem(theDialog,i,true);			for(i=_19_;i<=_20_;i++) StatTextItem(theDialog,i,true);			StatTextItem(theDialog,_22_,true);						sprintf(gTheText,"Crystal Family = Orthorhombic, Point Grp. = ");								break;		case 9:		case 10:		case 11:			for(i=_6_;i<=_7_;i++) StatTextItem(theDialog,i,true);			for(i=_9_;i<=_13_;i++) StatTextItem(theDialog,i,true);			for(i=_15_;i<=_17_;i++) StatTextItem(theDialog,i,true);			for(i=_19_;i<=_22_;i++) StatTextItem(theDialog,i,true);			sprintf(gTheText,"Crystal Family = Tetragonal, Point Grp. = ");			break;		case 12:		case 13:		case 14:		case 15:			for(i=_6_;i<=_8_;i++) StatTextItem(theDialog,i,true);			for(i=_9_;i<=_13_;i++) StatTextItem(theDialog,i,true);			for(i=_15_;i<=_17_;i++) StatTextItem(theDialog,i,true);			for(i=_19_;i<=_22_;i++) StatTextItem(theDialog,i,true);			sprintf(gTheText,"Crystal Family = Tetragonal, Point Grp. =");			break;		case 16:		case 17:			for(i=_7_;i<=_11_;i++) StatTextItem(theDialog,i,true);			StatTextItem(theDialog,_13_,true);			for(i=_15_;i<=_17_;i++) StatTextItem(theDialog,i,true);			for(i=_19_;i<=_23_;i++) StatTextItem(theDialog,i,true);						if(lattice_Type == TRIGONAL){				sprintf(gTheText,"Crystal Family = Trigonal, Point Grp. =");			}else {				sprintf(gTheText,"Crystal Family = Rhombohedral, Point Grp. = ");			}			break;		case 18:		case 19:		case 20:			for(i=_7_;i<=_13_;i++) StatTextItem(theDialog,i,true);			for(i=_15_;i<=_17_;i++) StatTextItem(theDialog,i,true);			for(i=_19_;i<=_23_;i++) StatTextItem(theDialog,i,true);			if(lattice_Type == TRIGONAL){				sprintf(gTheText,"Crystal Family = Trigonal, Point Grp. =");			}else {				sprintf(gTheText,"Crystal Family = Rhombohedral, Point Grp. =");			}			break;		case 21:		case 22:		case 23:		case 24:		case 25:		case 26:		case 27:			for(i=_6_;i<=_13_;i++) 	StatTextItem(theDialog,i,true);			for(i=_15_;i<=_17_;i++) StatTextItem(theDialog,i,true);			for(i=_19_;i<=_23_;i++) StatTextItem(theDialog,i,true);			sprintf(gTheText,"Crystal Family = Hexagonal, Point Grp. = ");			break;		case 28:		case 29:		case 30:		case 31:		case 32:			for(i=_5_;i<=_17_;i++) 	StatTextItem(theDialog,i,true);			for(i=_19_;i<=_23_;i++) StatTextItem(theDialog,i,true);			sprintf(gTheText,"Crystal Family = Cubic, Point Grp. = ");			break;							default:			break;		}		theCrystal->PointGrpName(theText);		strcat		(gTheText,theText);		sprintf(theText," Space Group =");		strcat		(gTheText,theText);		theCrystal->SpaceGrpName(theText);		strcat		(gTheText,theText);		GetDItem	(theDialog,_28_,&gType,&gTheHandle,&gTheRect);		MoveTo(gTheRect.left + 5,gTheRect.bottom);		TextSize(10);		TextFont(geneva);		DrawDiffractString(c2pstr(gTheText));		TextSize(12);		TextFont(0);	//	SetIText	(gTheHandle,c2pstr(gTheText));		return;}	Boolean ElasticConstant::DoDefine(void){	DialogPtr 		theDialog;	short			theSelect;	Boolean			quit = 0;	Boolean			saveData;	pascal Boolean 	TheFilter();	theDialog	= DM_GetNewDialog(ELASTIC_DLOG,NUL,IN_FRONT);	DoSetUp( theDialog);	while(!quit){		ModalDialog(TheFilterUPP,&theSelect);		switch(theSelect){			case ML_UPDATE_EVT:					BeginUpdate(theDialog);				UpdtDialog(theDialog,theDialog->visRgn);				if(!gAppleEvtsOK){					HiliteOK(theDialog);				}				quit = DoHit( theDialog,theSelect,&saveData);				EndUpdate(theDialog);				break;			default:				quit = DoHit( theDialog,theSelect,&saveData);			break;		}	}		DoRead(saveData);	DM_DisposDialog(&theDialog);	return saveData;}void ElasticConstant::SetTheNewConstants(DialogPtr theDialog){	short i;	for(i=5;i<=25;i++){		GetDItem(theDialog,i,&gType,&gTheHandle,&gTheRect);		sprintf(gTheText,"%6.3f",theCrystal->elasticConstants[i-5]);		SetIText(gTheHandle,c2pstr(gTheText));	}		return;}void ElasticConstant::DoRead(Boolean saveData){	if(saveData)	{		DoCopy(originalCrystal);	}	DoClose();}void ElasticConstant::DoSetUp(DialogPtr theDialog){	dm_EraseRect(&theDialog->portRect);	EnableDisableItems(theDialog);		DrawDialog(theDialog);	theCrystal->ElasticConstantSymmetry();	SetTheNewConstants(theDialog);} Boolean ElasticConstant::DoHit(DialogPtr theDialog,short theSelect,Boolean *saveData){		double theValue;		static short  oldSelect;				oldSelect = theSelect;				if(oldSelect != theSelect){			theCrystal->ElasticConstantSymmetry();			SetTheNewConstants(theDialog);		}		switch(theSelect){			case -1:			case 2:				*saveData = false;				return true;			case DLOG_ENTER_OR_CR:			case 1:				theCrystal->ElasticConstantSymmetry();				SetTheNewConstants(theDialog);				*saveData = true;				return true;						case 5:			case 6:			case 7:			case 8:			case 9:			case 10:			case 11:			case 12:			case 13:			case 14:			case 15:			case 16:			case 17:			case 18:			case 19:			case 20:			case 21:			case 22:			case 23:			case 24:			case 25:				GetDItem(theDialog,theSelect,&gType,&gTheHandle,&gTheRect);				GetIText(gTheHandle,pTheText);				theValue = atof(p2cstr(pTheText));				if(theValue == theCrystal->elasticConstants[theSelect-5])					break;				theCrystal->elasticConstants[theSelect-5] = theValue;				theCrystal->ElasticConstantSymmetry();				SetTheNewConstants(theDialog);				break;			default:				break;			case ML_UPDATE_EVT:			DrawDialog(theDialog);			break;		}		*saveData = false;		return false;	}