#include	"SF_MathLib.h"double	StructureFactor(h,k,l,theUs,theVs,theWs,num,theZs)double	h,k,l,*theUs,*theVs,*theWs,*theZs;long	num;{	register double	a,b,c,d,e,*u,*v,*w;	register long	i,j;	double			realPart,imagPart,twoPi,total;		u = theUs;	v = theVs;	w = theWs;	j = num;	realPart = imagPart = 0.0;	twoPi = 6.28318530717958648;	asm{		MOVEA.L		theZs,A1		FMOVE.X		h,fp0		FMOVE.X		twoPi,fp1		}	for(i = 1 ; i <= j ; i++){		asm{			FMOVE.X		(u),fp7				FMUL		fp0,fp7				; h * u -> fp7			FMOVE.X		(v),fp6					FMOVE.X		k,fp5			FMUL		fp5,fp6				; k * v -> fp6			FMOVE.X		(w),fp4			FADD		fp6,fp7				; (h * u) + (k * v) ->fp7			FMOVE.X		l,fp0					FMUL		fp0,fp4				; l * w -> fp4			LEA			0x000C(u),u			; u++			FADD		fp4,fp7				; (l * w) + ((h * u) + (k * v)) -> fp7			FMUL		twoPi,fp7			; 2¹ * ((l * w) + (k * v) + (h * u)) -> fp7			LEA			0x000C(v),v			; v++						FSINCOS.X	fp7,fp5:fp6			; sin(fp7) -> fp6 cos(fp7) -> fp5						FMOVE.X		(A1),fp4			; Z -> fp4			FMOVE.X		imagPart,fp0			FMOVE.X		realPart,fp1			FMUL		fp4,fp6				; Z * sin(Angle)			LEA			0x000C(A1),A1		; theZs++			FADD		fp0,fp6				; imagPart + (z * sin(Angle)) -> fp6						LEA			0x000C(w),w			; w++			FMUL		fp4,fp5				; Z * cos(Angle)			FMOVE.X		fp6,imagPart			FADD		fp1,fp5				; realPart +  (z * cos(Angle)) -> fp5			FMOVE.X		h,fp0					FMOVE.X		fp5,realPart		}			}		asm{		FMOVE.X	imagPart,fp7		FMUL	fp7,fp7		FMOVE.X	realPart,fp6		FMUL	fp6,fp6		FADD	fp6,fp7		FSQRT	fp7		FMOVE.X	fp7,total		}	return(total);}