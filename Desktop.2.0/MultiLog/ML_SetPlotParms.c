#include "ML_PlotSetUp.h"#include	"Diffract_INCs.h"void	ML_SetPlotParam(Ptr	owner,DialogPtr theDialog,Ptr *theParams){	DiffractObject*			theOwner;	ML_SetPlotParamsPtr		theP;	theOwner				= (DiffractObject*)owner;		theP = (ML_SetPlotParamsPtr)D_NewPtr(sizeof(ML_SetPlotParams));	*theParams = (Ptr)theP;	theOwner->ML_SetPlotParameters( theDialog,theP);}void	ML_SwitchPlotParam(Ptr	owner,DialogPtr theDialog, short theSelect,Ptr theParams){	DiffractObject*		theOwner;	ML_SetPlotParamsPtr theP;	Boolean				saveData;		theP = (ML_SetPlotParamsPtr)theParams;		theOwner		= (DiffractObject*)owner;	theOwner->ML_SwitchPlotParameters( theDialog, theSelect,theP,&saveData);}void	ML_ReadPlotParam(Ptr owner,DialogPtr theDialog,Ptr thePtr,Boolean saveData){	DiffractObject*		theOwner;	ML_SetPlotParamsPtr    theParams;	theParams = (ML_SetPlotParamsPtr)thePtr;	theOwner		= (DiffractObject*)owner;	theOwner->ML_ReadPlotParameters( theDialog,theParams, saveData);	}void DiffractObject::ML_SetPlotParameters(DialogPtr theDialog,ML_SetPlotParamsPtr thePtr){	short i;		for(i = 6; i <= 65;i++){		GetDItem(theDialog,i,&gType,&gTheHandle,&gTheRect);		SetCtlValue((ControlHandle)gTheHandle,0);	}	thePtr->direction_Flag = false;	for(i = 0; i <= 4;i++){		thePtr->theSymbols_P[i] = (i * 12) + 6  + theCrysSymbols_P[i];		thePtr->theSymbols_D[i] = (i * 12) + 6  + theCrysSymbols_D[i];		GetDItem(theDialog,thePtr->theSymbols_P[i],&gType,&gTheHandle,&gTheRect);		SetCtlValue((ControlHandle)gTheHandle,1);	}	}void DiffractObject::ML_ReadPlotParameters(DialogPtr theDialog,ML_SetPlotParamsPtr thePtr,Boolean saveData){	short i;	theDialog = theDialog;	if(saveData){		for(i = 0; i <= 4;i++){			if(theCrysSymbols_P[i] != thePtr->theSymbols_P[i] - 6 - (i * 12 ))newPictReq = true;			theCrysSymbols_P[i] = thePtr->theSymbols_P[i] - 6 - (i * 12 );			if(theCrysSymbols_D[i] != thePtr->theSymbols_D[i] - 6 - (i * 12))newPictReq = true;			theCrysSymbols_D[i] = thePtr->theSymbols_D[i] - 6 - (i * 12);		}	}	KillPtr(thePtr);}Boolean DiffractObject::ML_SwitchPlotParameters(DialogPtr theDialog,short theSelect,ML_SetPlotParamsPtr thePr,Boolean *saveData){	short	theSymbols_P[5];	short	theSymbols_D[5];	Boolean	direction_Flag;	short	i;	for(i = 0; i <= 4;i++){		theSymbols_P[i] = thePr->theSymbols_P[i];		theSymbols_D[i] = thePr->theSymbols_D[i];	}	direction_Flag =  thePr->direction_Flag;	switch(theSelect){			case -1:			case 2:							*saveData = false;				return true;			case DLOG_ENTER_OR_CR:			case 1:				*saveData = true;				return true;			case 5:				direction_Flag = SwitchBoolean(theDialog,5,direction_Flag);				if(!direction_Flag){					GetDItem(theDialog,5,&gType,&gTheHandle,&gTheRect);					sprintf(gTheText,"Spot Shape - Plane");					SetCTitle((ControlHandle)gTheHandle,c2pstr(gTheText));					for(i = 0; i <= 4;i++){						GetDItem(theDialog,theSymbols_D[i],&gType,&gTheHandle,&gTheRect);						SetCtlValue((ControlHandle)gTheHandle,0);						GetDItem(theDialog,theSymbols_P[i],&gType,&gTheHandle,&gTheRect);						SetCtlValue((ControlHandle)gTheHandle,1);					}				}else{					GetDItem(theDialog,5,&gType,&gTheHandle,&gTheRect);					sprintf(gTheText,"Spot Shape - Direction");					SetCTitle((ControlHandle)gTheHandle,c2pstr(gTheText));					for(i = 0; i <= 4;i++){						GetDItem(theDialog,theSymbols_P[i],&gType,&gTheHandle,&gTheRect);						SetCtlValue((ControlHandle)gTheHandle,0);						GetDItem(theDialog,theSymbols_D[i],&gType,&gTheHandle,&gTheRect);						SetCtlValue((ControlHandle)gTheHandle,1);					}				}				break;			case 6:			case 7:			case 8:			case 9:			case 10:			case 11:			case 12:			case 13:			case 14:			case 15:			case 16:			case 17:											if(theSymbols_D[0] != theSelect && direction_Flag){					GetDItem(theDialog,theSelect,&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,1);					GetDItem(theDialog,theSymbols_D[0],&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,0);					theSymbols_D[0] = theSelect;				}				if(theSymbols_P[0] != theSelect && !direction_Flag){					GetDItem(theDialog,theSelect,&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,1);					GetDItem(theDialog,theSymbols_P[0],&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,0);					theSymbols_P[0] = theSelect;				}				break;			case 18:			case 19:			case 20:			case 21:			case 22:			case 23:			case 24:			case 25:			case 26:			case 27:			case 28:			case 29:							if(theSymbols_D[1] != theSelect && direction_Flag){					GetDItem(theDialog,theSelect,&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,1);					GetDItem(theDialog,theSymbols_D[1],&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,0);					theSymbols_D[1] = theSelect;				}				if(theSymbols_P[1] != theSelect && !direction_Flag){					GetDItem(theDialog,theSelect,&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,1);					GetDItem(theDialog,theSymbols_P[1],&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,0);					theSymbols_P[1] = theSelect;				}				break;			case 30:			case 31:			case 32:			case 33:				case 34:			case 35:			case 36:			case 37:			case 38:			case 39:			case 40:			case 41:							if(theSymbols_D[2] != theSelect && direction_Flag){					GetDItem(theDialog,theSelect,&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,1);					GetDItem(theDialog,theSymbols_D[2],&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,0);					theSymbols_D[2] = theSelect;				}				if(theSymbols_P[2] != theSelect && !direction_Flag){					GetDItem(theDialog,theSelect,&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,1);					GetDItem(theDialog,theSymbols_P[2],&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,0);					theSymbols_P[2] = theSelect;				}				break;			case 42:			case 43:			case 44:			case 45:			case 46:			case 47:			case 48:			case 49:			case 50:			case 51:			case 52:			case 53:							if(theSymbols_D[3] != theSelect && direction_Flag){					GetDItem(theDialog,theSelect,&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,1);					GetDItem(theDialog,theSymbols_D[3],&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,0);					theSymbols_D[3] = theSelect;				}				if(theSymbols_P[3] != theSelect && !direction_Flag){					GetDItem(theDialog,theSelect,&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,1);					GetDItem(theDialog,theSymbols_P[3],&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,0);					theSymbols_P[3] = theSelect;				}				break;			case 54:			case 55:			case 56:			case 57:			case 58:			case 59:			case 60:			case 61:			case 62:			case 63:			case 64:			case 65:							if(theSymbols_D[4] != theSelect && direction_Flag){					GetDItem(theDialog,theSelect,&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,1);					GetDItem(theDialog,theSymbols_D[4],&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,0);					theSymbols_D[4] = theSelect;				}				if(theSymbols_P[4] != theSelect && !direction_Flag){					GetDItem(theDialog,theSelect,&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,1);					GetDItem(theDialog,theSymbols_P[4],&gType,&gTheHandle,&gTheRect);					SetCtlValue((ControlHandle)gTheHandle,0);					theSymbols_P[4] = theSelect;				}				break;							default:				break;			case ML_UPDATE_EVT:			DrawDialog(theDialog);			break;		}		for(i = 0; i <= 4;i++){			thePr->theSymbols_P[i] = theSymbols_P[i];			thePr->theSymbols_D[i] = theSymbols_D[i];		}		 thePr->direction_Flag = direction_Flag;		return false;}Boolean DiffractObject::SetPlotParameters(void){	DialogPtr 	theDialog;	Boolean	quit = false;	Boolean	saveData;	ML_SetPlotParamsPtr thePtr;	short			theSelect;	theDialog	= DM_GetNewDialog(151,NUL,IN_FRONT);	thePtr = (ML_SetPlotParamsPtr)D_NewPtr(sizeof(ML_SetPlotParams));	ML_SetPlotParameters( theDialog, thePtr);	while(!quit){		ModalDialog(TheFilterUPP,&theSelect);		switch(theSelect){			case ML_UPDATE_EVT:				BeginUpdate(theDialog);			UpdtDialog(theDialog,theDialog->visRgn);			if(!gAppleEvtsOK){				HiliteOK(theDialog);			}			quit = ML_SwitchPlotParameters( theDialog, theSelect, thePtr,&saveData);			EndUpdate(theDialog);			break;			default:			quit = ML_SwitchPlotParameters( theDialog, theSelect, thePtr,&saveData);			break;			}	}	ML_ReadPlotParameters( theDialog, thePtr, saveData);	DM_DisposDialog(&theDialog);	return saveData;}