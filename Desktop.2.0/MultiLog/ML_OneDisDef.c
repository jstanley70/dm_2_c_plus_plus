#include "ML_OneDisDef.h"#include 	"OneDisObj.h" #include	"Diffract_INCs.h"void	 ML_DoDisDefSetup(Ptr	owner,DialogPtr theDialog,Ptr *theParams){	OneDisObj*			theOwner;	ML_DislocSetPtr  theP;	theOwner					= (OneDisObj*)owner;	theP = (ML_DislocSetPtr)D_NewPtr(sizeof(ML_DislocSet));	*theParams =  (Ptr)theP;	theOwner->DislocDefSetUp( theDialog,theP);}void	ML_DoDislocDefHit(Ptr	owner,DialogPtr theDialog, short theSelect,Ptr theParams){	OneDisObj*		theOwner;	Boolean		saveData;	ML_DislocSetPtr  theP;		theOwner		= (OneDisObj*)owner;	theP			=	(ML_DislocSetPtr)theParams;	theOwner->DislocDefSwitch( theDialog,theP, theSelect,&saveData);}void	ML_DoDislocDefRead(Ptr owner,DialogPtr theDialog,Ptr theParams,Boolean saveData){	OneDisObj*		theOwner;	ML_DislocSetPtr  theP;		theOwner		= (OneDisObj*)owner;	theP			=	(ML_DislocSetPtr)theParams;		theOwner->DislocDefRead( theDialog,theP, saveData);}void OneDisObj::DislocDefSetUp(DialogPtr theDialog,ML_DislocSetPtr theParams){	theParams->oldDir	= (Index*)D_new(Index);	theParams->oldBur	= (Index*)D_new(Index);	lineDirection->DoCopy(theParams->oldDir);	burgersVector->DoCopy(theParams->oldBur);	GetDItem(theDialog,_12_,&gType,&gTheHandle,&theParams->theRect);		DoDefectSetUp(theDialog);	DrawDislocationSchematic(theParams->theRect,lineDirection,burgersVector,true);}Boolean OneDisObj::DislocDefSwitch(DialogPtr theDialog,ML_DislocSetPtr theParams,short theSelect,Boolean *saveData){	switch(theSelect){		case -1:		case 2:			*saveData = false;			return true;					case 1:			*saveData = true;			return true;						break;		case _3_:		case _4_:		case _5_:			GetCurrentDefectValues(theDialog);			DrawDislocationSchematic(theParams->theRect,lineDirection,burgersVector,true);		break;		case _7_:						GetCurrentDefectValues(theDialog);			InsertCurrentDefects();			numberDefect_Sets++;			if(!ResetDefects(numberDefect_Sets))				AddDefects(theDialog,true);			DoDefectSetUp(theDialog);			break;		case _8_:			if(numberDefect_Sets < 2) break;			GetCurrentDefectValues(theDialog);			InsertCurrentDefects();						numberDefect_Sets--;			ResetDefects(numberDefect_Sets);			DoDefectSetUp(theDialog);						break;		default:			break;		case ML_UPDATE_EVT:			DrawDialog(theDialog);			break;	}	return false;}void	OneDisObj::DislocDefRead(DialogPtr theDialog,ML_DislocSetPtr theParams,Boolean saveData){	if(saveData){		theParams->oldDir->DoCopy(lineDirection);		theParams->oldBur->DoCopy(burgersVector);		GetCurrentDefectValues(theDialog);		InsertCurrentDefects();	}	theParams->oldDir	->DoClose();	theParams->oldBur	->DoClose();	KillPtr(theParams);}Boolean OneDisObj::DefineDislocation(void){	DialogPtr 		theDialog;	short			theSelect;	ML_DislocSetPtr theParams;	Boolean			 saveData,quit = false;		theDialog	= 	DM_GetNewDialog(331,NUL,IN_FRONT);	theParams	=	(ML_DislocSet*)D_NewPtr(sizeof(ML_DislocSet));	DislocDefSetUp(theDialog,theParams);			while(!quit){		ModalDialog(TheFilterUPP,&theSelect);		switch(theSelect){			case ML_UPDATE_EVT:				BeginUpdate(theDialog);			UpdtDialog(theDialog,theDialog->visRgn);			if(!gAppleEvtsOK){				HiliteOK(theDialog);			}			quit = DislocDefSwitch( theDialog, theParams, theSelect, &saveData);			EndUpdate(theDialog);			break;			default:			quit = DislocDefSwitch( theDialog, theParams, theSelect, &saveData);			break;			}			}	DislocDefRead( theDialog,theParams, saveData);		DM_DisposDialog(&theDialog);		return saveData;}