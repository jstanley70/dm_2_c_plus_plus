#include "ML_CBED.h"#include	"CBEDObj.h"#include "ML_Crystal.h"#include "ML_PPT_Info.h"#include "ML_BeamOrientation.h"#include "ML_CrystalFace.h"#include "ML_Default.h"#include "ML_Misc_Plot.h"void	ML_DoCBEDObjSetup(Ptr	owner,DialogPtr theDialog,Ptr *theParams){	CBEDObj*			theOwner;	theOwner					= (CBEDObj*)owner;	theOwner->SetDefineObj( theDialog);	*theParams = (Ptr)0L;	DrawDialog(theDialog);}void	ML_DoCBEDObjHit(Ptr	owner,DialogPtr theDialog, short theSelect,Ptr theParams){	CBEDObj*		theOwner;	Boolean		saveData;		theOwner		= (CBEDObj*)owner;	theParams		= (Ptr)NUL;             // Eliminates warning;  theParams is required		theOwner->DefineSwitch( theDialog, theSelect,&saveData);}void	ML_DoCBEDObjRead(Ptr owner,DialogPtr theDialog,Ptr theParams,Boolean saveData){	CBEDObj*		theOwner;	theOwner		= (CBEDObj*)owner;	theParams		= (Ptr)NUL; 	((CBEDObj*)theOwner)->ReadDefineDialog( theDialog, saveData);}Boolean	CBEDObj::DefineSwitch(DialogPtr theDialog,short theSelect,Boolean *saveData){	switch(theSelect){			Boolean theFlag;			case -1:			case 2:				*saveData = false;				return true;				break;			case DLOG_ENTER_OR_CR:			case 1:				*saveData = true;					return true;				break;			case 5:			case 6:			case 7:			case 8:			case 9:			case 10:			case 11:				theFlag = GetBoolean(theDialog,theSelect);				theFlag = SwitchBoolean(theDialog,theSelect,theFlag);				break;			case ML_UPDATE_EVT:				DrawDialog(theDialog);			break;			default:				break;		}		return false;}void  CBEDObj::SetDefineObj(DialogPtr theDialog){	short i,n = 5;	for(i = n; i <= n + 3;i++){		plotFlags[i-n] = SwitchBoolean(theDialog,i,!plotFlags[i-n]);	}	greyFlag = SwitchBoolean(theDialog,9,!greyFlag);	showPeriods = SwitchBoolean(theDialog,10,!showPeriods);	kikuchiLines = SwitchBoolean(theDialog,11,!kikuchiLines);	SetItemValue(theDialog,12,kLimit,0);	DrawDialog(theDialog);	}void	CBEDObj::DoDefine(void){	Boolean			calculateFlag;	MultiLog*		theMultiLog;	short				n = 0;		theMultiLog	= (MultiLog*)new(MultiLog);	theMultiLog->DoInit(265,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCBEDObjSetup,(HitProcPtr)ML_DoCBEDObjHit,(ReadProcPtr)ML_DoCBEDObjRead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoBeamESetup,(HitProcPtr)ML_DoBeamEHit,(ReadProcPtr)ML_DoBeamERead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoBeamORSetup,(HitProcPtr)ML_DoBeamORHit,(ReadProcPtr)ML_DoBeamORRead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[0]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoStageObjSetup,(HitProcPtr)ML_DoStageObjHit,(ReadProcPtr)ML_DoStageObjRead,(Ptr)stage);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[1]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[2]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[3]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoPPTSetup,(HitProcPtr)ML_DoPPTHit,(ReadProcPtr)ML_DoPPTRead,(Ptr)the_PPT_Info[0]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoPPTSetup,(HitProcPtr)ML_DoPPTHit,(ReadProcPtr)ML_DoPPTRead,(Ptr)the_PPT_Info[1]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoPPTSetup,(HitProcPtr)ML_DoPPTHit,(ReadProcPtr)ML_DoPPTRead,(Ptr)the_PPT_Info[2]);		theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoFoilSetup,(HitProcPtr)ML_DoFoilHit,(ReadProcPtr)ML_DoFoilRead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_SetMiscParam,(HitProcPtr)ML_SwitchMiscParam,(ReadProcPtr)ML_ReadMiscParam,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoDefaultSetup,(HitProcPtr)ML_DoDefaultHit,(ReadProcPtr)ML_DoDefaultRead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoSFSetup,(HitProcPtr)ML_DoSFHit,(ReadProcPtr)ML_DoSFRead,(Ptr)this);		calculateFlag = theMultiLog->DoMultiLog();	theMultiLog->DoClose();		if(calculateFlag && screenPict == NUL  && gMyOffG == 0L){		changedFlag = true;		reSizeFlag = true;		newPictReq = true;/*eliminated line dec 1992*/	} else if(screenPict == NUL  && gMyOffG == 0L){		CloseTheObject(theWindow);	}	return;}void		CBEDObj::ReadDefineDialog(DialogPtr theDialog,Boolean saveData){	short i;	short n = 5;	short	oldLimit;	if(saveData){				/* Eric re-wrote this section July 1993 */		Boolean theFlag;		DoDefineOR( theDialog, false,_3_);		for(i = n ; i <= n + 3 ; i++){			theFlag = GetBoolean(theDialog,i);			if(plotFlags[i - n] < theFlag)changedFlag = true;			plotFlags[i - n] = theFlag;		}		if(greyFlag 			!= GetBoolean(theDialog,9)) newPictReq = true;		greyFlag 			= GetBoolean(theDialog,9);		if(showPeriods 	!= GetBoolean(theDialog,10))newPictReq = true;		showPeriods 	= GetBoolean(theDialog,10);		if(kikuchiLines 	!= GetBoolean(theDialog,11))newPictReq = true;		kikuchiLines 	= GetBoolean(theDialog,11);		oldLimit = kLimit;		kLimit = GetItemValue(theDialog,12);		if(kLimit != oldLimit && kikuchiLines)changedFlag = true;		baseCrystal = -1;		i = -1;		while(baseCrystal < 0 && i < 3){			i++;			if(plotFlags[i]){				setCrystal = theCrystal[i];				baseCrystal = i;			}		}		if(baseCrystal < 0){			setCrystal = theCrystal[0];			baseCrystal = 0;		}	}}void CBEDObj::DoSetUp(void){	DialogPtr 		theDialog;	short			theSelect;	Boolean			quit = false;	Boolean			saveData = false;			theDialog	= DM_GetNewDialog(11123,NUL,IN_FRONT);	SetDefineObj(theDialog);	while(!quit){		ModalDialog(TheFilterUPP,&theSelect);		switch(theSelect){			case ML_UPDATE_EVT:				BeginUpdate(theDialog);			UpdtDialog(theDialog,theDialog->visRgn);			if(!gAppleEvtsOK){				HiliteOK(theDialog);			}			quit = DefineSwitch( theDialog,theSelect,&saveData);			EndUpdate(theDialog);			break;			default:			quit = DefineSwitch( theDialog,theSelect,&saveData);			break;			}			}	ReadDefineDialog( theDialog, saveData);	DM_DisposDialog(&theDialog);		return;}