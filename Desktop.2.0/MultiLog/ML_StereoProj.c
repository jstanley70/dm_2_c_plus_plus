#include "ML_StereoProj.h"#include "ML_Crystal.h"#include "ML_PPT_Info.h"#include "ML_Default.h"#include "ML_Misc_Plot.h"void StereoObject::DoSetUp(void){	DialogPtr 		theDialog;	short			theSelect;	Boolean			quit = false;	Boolean			saveData = false;	Ptr	theParams;	theDialog	= DM_GetNewDialog(130,NUL,IN_FRONT);	DoSPSetup((Ptr)this, theDialog,&theParams);	while(!quit){		ModalDialog(TheFilterUPP,&theSelect);		switch(theSelect){			case 1:				quit = true;				saveData = true;				break;			case 2:				quit = true;				saveData = false;				break;			case ML_UPDATE_EVT:				BeginUpdate(theDialog);			UpdtDialog(theDialog,theDialog->visRgn);			if(!gAppleEvtsOK){				HiliteOK(theDialog);			}			DoSPHit((Ptr)this, theDialog,  theSelect, theParams);			EndUpdate(theDialog);			break;			default:			DoSPHit((Ptr)this, theDialog,  theSelect, theParams);			break;			}	}	DoSPRead((Ptr)this,theDialog, theParams, saveData);	DM_DisposDialog(&theDialog);	return;}void	DoSPSetup(Ptr	owner,DialogPtr theDialog,Ptr *theParams){	char				theText[255];	short				type,i,j,n,theSelect;	Handle				theHandle;	Rect				theRect;	StereoObject*		theOwner;		theOwner		= (StereoObject*)owner;	*theParams		= (Ptr)NUL;		for(i = P0_TEXT , j = 0 ; i <= D3_TEXT ; i++){		if(((i - P0_TEXT) % 2) == 0){			n = theOwner->planeBounds[j];		} else {			n = theOwner->dirBounds[j++];		}			GetDItem(theDialog,(i - P0_TEXT + MATRIX_PLANE),&type,&theHandle,&theRect);		if(n <= 0){			SetCtlValue((ControlHandle)theHandle,0);			n = abs(n);		} else {			SetCtlValue((ControlHandle)theHandle,1);		}		GetDItem(theDialog,i,&type,&theHandle,&theRect);		sprintf(theText,"%d",n);		c2pstr(theText);		SetIText(theHandle,(unsigned char*)theText);	}	SelIText(theDialog,P0_TEXT,0,10);	theOwner->labelMatrixFlag 	= SwitchBoolean(theDialog,ADD_LABELS,!theOwner->labelMatrixFlag);	theOwner->structFactFlag 	= SwitchBoolean(theDialog,STRUCT_FACTS,!theOwner->structFactFlag);	theOwner->greyFlag 			= SwitchBoolean(theDialog,GREY_SCALE,!theOwner->greyFlag);	theOwner->full_Symmetry 	= SwitchBoolean(theDialog,FULL_SYMMETRY,!theOwner->full_Symmetry);		SetItemValue(theDialog,LBL_TO_TEXT,(double)theOwner->labelBounds,0);		theSelect = P0_TEXT;	for(i = PPT_3_DIR ; i >= MATRIX_PLANE ; i--){		GetDItem(theDialog,i,&type,&theHandle,&theRect);		if(GetCtlValue((ControlHandle)theHandle) == 0){			HideDItem (theDialog,i - MATRIX_PLANE + P0_TEXT);		} else {			theSelect = i - MATRIX_PLANE + P0_TEXT;			ShowDItem (theDialog,theSelect);		}	}	SelIText(theDialog,theSelect,0,200);}void	DoSPHit(Ptr	owner,DialogPtr theDialog, short theSelect,Ptr theParams){	short				type;	Handle				theHandle;	Rect				theRect;	StereoObject*		theOwner;		theOwner		= (StereoObject*)owner;	theParams		= (Ptr)NUL;             // Eliminates warning;  theParams is required		switch(theSelect){		case MATRIX_PLANE:		case MATRIX_DIR:		case PPT_1_PLANE:		case PPT_1_DIR:		case PPT_2_PLANE:		case PPT_2_DIR:		case PPT_3_PLANE:		case PPT_3_DIR:			GetDItem(theDialog,theSelect,&type,&theHandle,&theRect);			theSelect += (P0_TEXT - MATRIX_PLANE);			if(GetCtlValue((ControlHandle)theHandle) == 0){				SetCtlValue((ControlHandle)theHandle,1);				ShowDItem (theDialog,theSelect);				SelIText(theDialog,theSelect,0,200);			} else {				SetCtlValue((ControlHandle)theHandle,0);				HideDItem (theDialog,theSelect);			}			break;					case ADD_LABELS:			GetDItem(theDialog,theSelect,&type,&theHandle,&theRect);			if(GetCtlValue((ControlHandle)theHandle) == 0){				SetCtlValue((ControlHandle)theHandle,1);				SelIText(theDialog,LBL_TO_TEXT,0,100);			} else {				SetCtlValue((ControlHandle)theHandle,0);			}			break;					case GREY_SCALE:		case STRUCT_FACTS:		case FULL_SYMMETRY:			GetDItem(theDialog,theSelect,&type,&theHandle,&theRect);			if(GetCtlValue((ControlHandle)theHandle) == 0){				SetCtlValue((ControlHandle)theHandle,1);			} else {				SetCtlValue((ControlHandle)theHandle,0);			}			break;		case SP_UPDATE:			DrawDialog(theDialog);			break;		default:			break;	}}void	DoSPRead(Ptr	owner,DialogPtr theDialog,Ptr theParams,Boolean saveData){		char				theText[255],i,j,n;	short				type;	Handle				theHandle;	Rect				theRect;	StereoObject*		theOwner;		if(saveData){				theOwner		= (StereoObject*)owner;		theParams		= (Ptr)NUL;             // Eliminates warning;  theParams is required						for(i = P0_TEXT , j = 0; i <= D3_TEXT ; i++){			GetDItem(theDialog,i,&type,&theHandle,&theRect);			GetIText(theHandle,(unsigned char*)theText);			p2cstr((unsigned char*)theText);			n = atoi(theText);			GetDItem(theDialog,i - P0_TEXT + MATRIX_PLANE,&type,&theHandle,&theRect);			if(GetCtlValue((ControlHandle)theHandle) == 0)				n *= -1;			if(((i - P0_TEXT) % 2) == 0){				if(theOwner->planeBounds[j] != n)theOwner->changedFlag = true;				theOwner->planeBounds[j] = n;			} else {				if(theOwner->dirBounds[j] != n)theOwner->changedFlag = true;				theOwner->dirBounds[j++] = n;							}		}				theOwner->DoDefineOR(theDialog,false,MATRIX_PLANE);		theOwner->obj_Index->theCrystal 	= theOwner->theCrystal[theOwner->baseCrystal];		if(theOwner->greyFlag 	!= GetBoolean(theDialog,GREY_SCALE))theOwner->newPictReq = true;		theOwner->greyFlag 					= GetBoolean(theDialog,GREY_SCALE);				if(theOwner->labelMatrixFlag != GetBoolean(theDialog,ADD_LABELS))theOwner->changedFlag = true;		theOwner->labelMatrixFlag 			= GetBoolean(theDialog,ADD_LABELS);				if(theOwner->structFactFlag != GetBoolean(theDialog,STRUCT_FACTS))theOwner->changedFlag = true;		theOwner->structFactFlag 			= GetBoolean(theDialog,STRUCT_FACTS);						if(theOwner->full_Symmetry != GetBoolean(theDialog,FULL_SYMMETRY))theOwner->changedFlag = true;		theOwner->full_Symmetry 			= GetBoolean(theDialog,FULL_SYMMETRY);				if(theOwner->labelBounds != (short)GetItemValue(theDialog,LBL_TO_TEXT) && theOwner->labelMatrixFlag)			theOwner->changedFlag = true;					theOwner->labelBounds 	= (short)GetItemValue(theDialog,LBL_TO_TEXT);	}}void	StereoObject::DoDefine(void){	Boolean			calculateFlag;	MultiLog*		theMultiLog;	short			n = 0;		theMultiLog	= (MultiLog*)new(MultiLog);	theMultiLog->DoInit(251,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)DoSPSetup,(HitProcPtr)DoSPHit,(ReadProcPtr)DoSPRead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoBeamORSetup,(HitProcPtr)ML_DoBeamORHit,(ReadProcPtr)ML_DoBeamORRead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[0]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoStageObjSetup,(HitProcPtr)ML_DoStageObjHit,(ReadProcPtr)ML_DoStageObjRead,(Ptr)stage);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[1]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[2]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[3]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoPPTSetup,(HitProcPtr)ML_DoPPTHit,(ReadProcPtr)ML_DoPPTRead,(Ptr)the_PPT_Info[0]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoPPTSetup,(HitProcPtr)ML_DoPPTHit,(ReadProcPtr)ML_DoPPTRead,(Ptr)the_PPT_Info[1]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoPPTSetup,(HitProcPtr)ML_DoPPTHit,(ReadProcPtr)ML_DoPPTRead,(Ptr)the_PPT_Info[2]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_SetPlotParam,(HitProcPtr)ML_SwitchPlotParam,(ReadProcPtr)ML_ReadPlotParam,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_SetMiscParam,(HitProcPtr)ML_SwitchMiscParam,(ReadProcPtr)ML_ReadMiscParam,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoDefaultSetup,(HitProcPtr)ML_DoDefaultHit,(ReadProcPtr)ML_DoDefaultRead,(Ptr)this);	calculateFlag = theMultiLog->DoMultiLog();	theMultiLog->DoClose();		if(calculateFlag  && screenPict == NUL  && gMyOffG == 0L){		changedFlag = true;		reSizeFlag = true;		newPictReq = true;/*eliminated line dec 1992*/	} else if(screenPict == NUL  && gMyOffG == 0L){		CloseTheObject(theWindow);	}}