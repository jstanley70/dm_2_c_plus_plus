#include	"AngleTabObj.h"#include "Diffract_INCs.h"#include "ML_Crystal.h"#include "ML_AngleTab.h"#include "ML_Crystal.h"#include "ML_PPT_Info.h"#include "ML_Default.h"#include "ML_Misc_Plot.h"void	ML_DoAngleTabObjSetup(Ptr	owner,DialogPtr theDialog,Ptr *theParams){	AngleTabObj*			theOwner;	ML_AngleTabObjParmPtr	thePtr;	theOwner					= (AngleTabObj*)owner;	thePtr	=	(ML_AngleTabObjParmPtr)D_NewPtr(sizeof(ML_AngleTabObjParm));	theOwner->SetDefineObjAng( theDialog,thePtr);	*theParams = (Ptr)thePtr;}void	ML_DoAngleTabObjHit(Ptr	owner,DialogPtr theDialog, short theSelect,Ptr theParams){	AngleTabObj*		theOwner;	Boolean		saveData;	ML_AngleTabObjParmPtr	thePtr;	theDialog = theDialog;//warning	thePtr	=	(ML_AngleTabObjParmPtr)theParams;	theOwner		= (AngleTabObj*)owner;		theOwner->DefineSwitchAng(  theSelect,thePtr,&saveData);}void	ML_DoAngleTabObjRead(Ptr owner,DialogPtr theDialog,Ptr theParams,Boolean saveData){	AngleTabObj*		theOwner;	ML_AngleTabObjParmPtr	thePtr;	thePtr	=	(ML_AngleTabObjParmPtr)theParams;	theOwner		= (AngleTabObj*)owner;	theOwner->ReadDefineDialogAng( theDialog,thePtr, saveData);	KillPtr(theParams);}void AngleTabObj::SetDefineObjAng(DialogPtr theDialog,ML_AngleTabObjParmPtr theParams){		SetItemValue(theDialog,_3_,dspace1,2);	SetItemValue(theDialog,_4_,dspace2,2);		SetItemValue(theDialog,_5_,range,2);		SetItemValue(theDialog,_6_,angle,2);		SetItemValue(theDialog,_7_,angleRange,2);			theParams->theMenu = (PopUpMenu*)D_new(PopUpMenu);	theParams->theMenu->Init(theDialog,_8_,52,crystalNum  + 1);		theParams->theMenu2 = (PopUpMenu*)D_new(PopUpMenu);	theParams->theMenu2->Init(theDialog,_9_,52,crystalNum2  + 1);		DrawDialog(theDialog);}Boolean AngleTabObj::DefineSwitchAng(short  theSelect,ML_AngleTabObjParmPtr theParams,Boolean *saveData){	switch(theSelect){		case -1:		case 2:			*saveData = false;			return true;		case DLOG_ENTER_OR_CR:		case 1:			*saveData = true;			return true;			case _8_:				theParams->theMenu->DoPopUp();				theParams->theMenu2->lastResult = theParams->theMenu->lastResult;				theParams->theMenu2->SetPopUp();				break;			case _9_:				theParams->theMenu2->DoPopUp();				break;			case ML_UPDATE_EVT:			//DrawDialog(theDialog);			break;			default:				break;		}		return false;}void	AngleTabObj::ReadDefineDialogAng(DialogPtr theDialog,ML_AngleTabObjParmPtr theParams,Boolean saveData){	double min1,min2,rng;	if(saveData){		min1 	= GetItemValue(theDialog,_3_);		min2 	= GetItemValue(theDialog,_4_);		rng 	= GetItemValue(theDialog,_5_);		if(fabs(dspace1 - min1) > .01) changedFlag = true;		if(fabs(dspace2 - min2) > .01) changedFlag = true;		if(fabs(range - rng) > .01) newPictReq = true;		if(range < rng) changedFlag = true;		if(fabs(angle -  GetItemValue(theDialog,_6_)) > .01)changedFlag = true;		if(fabs(angleRange) < GetItemValue(theDialog,_7_))changedFlag = true;		rng 	/= 100.0;		min1	-= (min1 * rng);		min2	-= (min2 * rng);				if(min1 < .5 || min2 < .5){			GetIndString(pTheText,1004,1);			ParamText(pTheText,"\p","\p","\p");			if(CautionAlert(704,(ModalFilterUPP)NUL) == 2){				goto OUT_OF_HERE;			}		}		valid = true;		if(crystalNum != theParams->theMenu->lastResult - 1){			newPictReq = true;changedFlag = true;			crystalNum  = theParams->theMenu->lastResult - 1;		}		if(crystalNum2 != theParams->theMenu2->lastResult - 1){			newPictReq = true;changedFlag = true;			crystalNum2  = theParams->theMenu2->lastResult - 1;		}		setCrystal = theCrystal[crystalNum];		baseCrystal = crystalNum;					dspace1 = GetItemValue(theDialog,_3_);		dspace2 = GetItemValue(theDialog,_4_);		range = GetItemValue(theDialog,_5_);		angle = GetItemValue(theDialog,_6_);		angleRange 	= GetItemValue(theDialog,_7_);	}OUT_OF_HERE:	theParams->theMenu->DoClose();	theParams->theMenu2->DoClose();}void	AngleTabObj::DoDefine(void){	Boolean			calculateFlag;	MultiLog*		theMultiLog;	short				n = 0;		theMultiLog	= (MultiLog*)new(MultiLog);	theMultiLog->DoInit(258,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoAngleTabObjSetup,(HitProcPtr)ML_DoAngleTabObjHit,(ReadProcPtr)ML_DoAngleTabObjRead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[0]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[1]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[2]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[3]);		theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoPPTSetup,(HitProcPtr)ML_DoPPTHit,(ReadProcPtr)ML_DoPPTRead,(Ptr)the_PPT_Info[0]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoPPTSetup,(HitProcPtr)ML_DoPPTHit,(ReadProcPtr)ML_DoPPTRead,(Ptr)the_PPT_Info[1]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoPPTSetup,(HitProcPtr)ML_DoPPTHit,(ReadProcPtr)ML_DoPPTRead,(Ptr)the_PPT_Info[2]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_SetMiscParam,(HitProcPtr)ML_SwitchMiscParam,(ReadProcPtr)ML_ReadMiscParam,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoDefaultSetup,(HitProcPtr)ML_DoDefaultHit,(ReadProcPtr)ML_DoDefaultRead,(Ptr)this);	calculateFlag = theMultiLog->DoMultiLog();	theMultiLog->DoClose();		if(calculateFlag  && screenPict == NUL  && gMyOffG == 0L){		changedFlag = true;		reSizeFlag = true;		newPictReq = true;/*eliminated line dec 1992*/	} else if(screenPict == NUL  && gMyOffG == 0L){		CloseTheObject(theWindow);	}	return ;}#define PLANE_ANGLE_DIALOG 501void  AngleTabObj::DoDefineSetUp(void){	DialogPtr 		theDialog;	short			theSelect;	Boolean			quit = false;	Boolean			saveData;	ML_AngleTabObjParmPtr	thePtr;	thePtr	=	(ML_AngleTabObjParmPtr)D_NewPtr(sizeof(ML_AngleTabObjParm));	theDialog	= DM_GetNewDialog(PLANE_ANGLE_DIALOG,NUL,IN_FRONT);	SetDefineObjAng( theDialog,thePtr);	while(!quit){		ModalDialog(TheFilterUPP,&theSelect);		switch(theSelect){			case ML_UPDATE_EVT:				BeginUpdate(theDialog);			UpdtDialog(theDialog,theDialog->visRgn);			if(!gAppleEvtsOK){				HiliteOK(theDialog);			}			quit = DefineSwitchAng( theSelect,thePtr,&saveData);			EndUpdate(theDialog);			break;			default:			quit = DefineSwitchAng( theSelect,thePtr,&saveData);			break;			}			}		ReadDefineDialogAng( theDialog,thePtr, saveData);	KillPtr(thePtr);	DM_DisposDialog(&theDialog);	return;}