#include "ML_PPT_Info.h"#include	"Diffract_INCs.h"void	ML_DoPPTSetup(Ptr	owner,DialogPtr theDialog,Ptr	*paramBlock){	ML_PPTParamsPtr		theMLParms;	PPT_Info*			theOwner;	Handle				theHandle;	Rect				theRect;	short				type;	char				theText[256];		theOwner					= (PPT_Info*)owner;	theMLParms					= (ML_PPTParamsPtr)D_NewPtr(sizeof(ML_PPTParams));	theMLParms->theOwner		= theOwner;	*paramBlock					= (Ptr)theMLParms;		theMLParms->theIndex 		= (Index*)D_new(Index);	theMLParms->thisIndex 		= (Index*)D_new(Index);	theMLParms->thatIndex 		= (Index*)D_new(Index);	theMLParms->theORList 		= theOwner->InitORList(theDialog);	theMLParms->changed			= false;	theMLParms->theCell.h		= 0;	theMLParms->theCell.v		= 0;	GetDItem(theDialog,INTENSITY,&type,&theHandle,&theRect);	sprintf(theText,"%d",(short)(theOwner->intensity * 100));	SetIText(theHandle,c2pstr(theText));		theOwner->ListORs(theMLParms->theORList);}void		ML_DoPPTHit(Ptr	owner,DialogPtr theDialog, short theSelect,	Ptr	paramBlock){	ML_PPTParamsPtr		theMLParms;	PPT_Info*			theOwner;	Boolean				dblClick;	Handle				theHandle;	Rect				theRect;	short				type,i,num,length;	unsigned long				time;	char				theText[256];			theMLParms		= (ML_PPTParamsPtr)paramBlock;	theOwner		= (PPT_Info*)owner;			switch(theSelect){				case DLOG_ENTER_KEY:			GetDItem(theDialog,THE_CHECK_BOX,&type,&theHandle,&theRect);			HiliteControl((ControlHandle)theHandle,1);			Delay(8L,&time);			HiliteControl((ControlHandle)theHandle,0);			theMLParms->theCell.h	= 0;			theMLParms->theCell.v	= 0;			if(LGetSelect(true,&theMLParms->theCell,theMLParms->theORList)){				theOwner->CellUpdate(theDialog,theMLParms->theORList,theMLParms->theCell);			}			theMLParms->changed = true;			break;					case	THE_CHECK_BOX:			theMLParms->theCell.h	= 0;			theMLParms->theCell.v	= 0;			if(LGetSelect(true,&theMLParms->theCell,theMLParms->theORList)){				theOwner->CellUpdate(theDialog,theMLParms->theORList,theMLParms->theCell);			}			theMLParms->changed = true;			break;					case LOAD_PPT:			i = Alert(SELECT_XTAL,NUL);			switch(i){				case 1:					break;				case 2:					Message(NOT_VALID_FOR_MATRIX);					break;				case 3:				case 4:				case 5:					i -= 3;					(gDefault->the_PPT_Info[i])->DoCopy(theOwner);					theMLParms->changed = true;					break;				case 6:					Message(NOT_VALID_FOR_MATRIX);					break;				case 7:				case 8:				case 9:					i -= 7;					(gCurrentObj->the_PPT_Info[i])->DoCopy(theOwner);					theMLParms->changed = true;					break;				default:					break;			}			theOwner->KillORList(theMLParms->theORList);			theMLParms->theORList = theOwner->InitORList(theDialog);			theOwner->ListORs(theMLParms->theORList);			break;					case DUMP_PPT:			i = Alert(SELECT_XTAL,NUL);			switch(i){				case 1:					break;				case 2:					Message(NOT_VALID_FOR_MATRIX);					break;				case 3:				case 4:				case 5:					i -= 3;					theOwner->ReadData(theDialog);					theOwner->DoCopy((gDefault->the_PPT_Info[i]));					break;				case 6:					Message(NOT_VALID_FOR_MATRIX);					break;				case 7:				case 8:				case 9:					i -= 7;					theOwner->ReadData(theDialog);					theOwner->DoCopy((gDefault->the_PPT_Info[i]));					break;				default:					break;			}			theOwner->KillORList(theMLParms->theORList);			theMLParms->theORList = theOwner->InitORList(theDialog);			theOwner->ListORs(theMLParms->theORList);			break;					case SET_NUM_ORS:			theOwner->SeNumORs();			theOwner->KillORList(theMLParms->theORList);			theMLParms->theORList = theOwner->InitORList(theDialog);			theOwner->ListORs(theMLParms->theORList);			theMLParms->changed = true;			DrawDialog(theDialog);			break;					case VARIANTS:			theOwner->DoVariants();			theOwner->KillORList(theMLParms->theORList);			theMLParms->theORList = theOwner->InitORList(theDialog);			theOwner->ListORs(theMLParms->theORList);			theMLParms->changed = true;			break;				case INTENSITY:			theMLParms->changed = true;			break;					case DELETE:			if(theOwner->DeletePPt(theMLParms->theCell)){				theMLParms->changed = true;				i = theMLParms->theCell.v / 2;				LDelRow(2,i * 2,theMLParms->theORList);			}			theOwner->ListORs(theMLParms->theORList);			break;				case THE_LIST_RECT:			GlobalToLocal(&(gTheEvent.where));			dblClick = LClick(gTheEvent.where,gTheEvent.modifiers,theMLParms->theORList);			theMLParms->theCell = LLastClick(theMLParms->theORList);			num = 1 + theOwner->lastOR * 2;			if(theMLParms->theCell.v > num)				break;			if(dblClick && theMLParms->theCell.h == PARALLEL){				i = theMLParms->theCell.v / 2;				if((theMLParms->theCell.v % 2) == 0){					theMLParms->thisIndex = theOwner->theORs[i]->theMatrix1;					theMLParms->thatIndex = theOwner->theORs[i]->thePPT1;				} else {					theMLParms->thisIndex = theOwner->theORs[i]->theMatrix2;					theMLParms->thatIndex = theOwner->theORs[i]->thePPT2;				}				theMLParms->thisIndex->direction = !(theMLParms->thisIndex->direction);				theMLParms->thatIndex->direction = theMLParms->thisIndex->direction;				theMLParms->thisIndex->SetListDir(theMLParms->theORList,theMLParms->theCell);			} else {				GetDItem(theDialog,THE_LIST_DATA,&type,&theHandle,&theRect);				length = 10;				LGetCell(&(theText[1]),&length,theMLParms->theCell,theMLParms->theORList);				theText[0] = (char)length;				if(theMLParms->theCell.h == PARALLEL){					type = statText;					if(theText[1] == 'D'){						length = sprintf(&(theText[1]),"Plane");					} else {						length = sprintf(&(theText[1]),"Direction");					}					theText[0] = (char)length;				} else if(theMLParms->theCell.h == NUMBER && (theMLParms->theCell.v % 2) != 0){					LSetSelect(false,theMLParms->theCell,theMLParms->theORList);					theMLParms->theCell.v--;					LSetSelect(true,theMLParms->theCell,theMLParms->theORList);					length = 10;					LGetCell(&(theText[1]),&length,theMLParms->theCell,theMLParms->theORList);					theText[0] = (char)length;					type = editText;				}else if(theMLParms->theCell.h == OFF_ROTATION && (theMLParms->theCell.v % 2) != 0){					LSetSelect(false,theMLParms->theCell,theMLParms->theORList);					theMLParms->theCell.v--;					LSetSelect(true,theMLParms->theCell,theMLParms->theORList);					length = 10;					LGetCell(&(theText[1]),&length,theMLParms->theCell,theMLParms->theORList);					theText[0] = (char)length;					type = editText;				} else {					type = editText;				} 				SetIText(theHandle,(unsigned char*)theText);				SelIText(theDialog,THE_LIST_DATA,0,length);				SetDItem(theDialog,THE_LIST_DATA,type,theHandle,&theRect);			}			break;					case THE_SCROLL_RECT:			GlobalToLocal(&(gTheEvent.where));			dblClick = LClick(gTheEvent.where,gTheEvent.modifiers,theMLParms->theORList);			break;					case ML_UPDATE_EVT:			DrawDialog(theDialog);			break;	/*				case DO_MENU:			theOwner->ReadData(theDialog);			switch(DoMenu(GetWRefCon(theDialog))){				case 1:					DrawLines(theDialog);					theOwner->ListORs(theMLParms->theORList);					break;				case 2:					quitFlag = true;					break;				default:					DrawLines(theDialog);					theOwner->ListORs(theMLParms->theORList);					break;			}			break;	*/					default:			break;	}}void		ML_DoPPTRead(Ptr owner,DialogPtr theDialog,Ptr	paramBlock,Boolean saveData){	ML_PPTParamsPtr		theMLParms;	PPT_Info*			theOwner;		theMLParms		= (ML_PPTParamsPtr)paramBlock;	theOwner		= (PPT_Info*)owner;		if(saveData){		theOwner->ReadData(theDialog);		if(theMLParms->changed == true)gCurrentObj->changedFlag = true;	}		theOwner->KillORList(theMLParms->theORList);	theMLParms->theIndex->DoClose();	theMLParms->thisIndex->DoClose();	theMLParms->thatIndex->DoClose();	KillPtr((Ptr)paramBlock);}