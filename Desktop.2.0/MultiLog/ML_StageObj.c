#include "StageObj.h"#include "ML_StageObj.h"#include"Diffract_INCs.h"void	ML_DoStageObjSetup(Ptr	owner,DialogPtr theDialog,Ptr	*paramBlock){	ML_StageObjParamsPtr	theMLParms;	StageObj*				theOwner;	theOwner					= (StageObj*)owner;	theMLParms					= (ML_StageObjParamsPtr)D_NewPtr(sizeof(ML_StageObjParams));	/*theMLParms->v =  gCurrentObj->centerY;*/	theMLParms->enableBragg 	= theOwner->enableBragg;	GetPenState(&theMLParms->thePenState);//	theMLParms->position = theOwner->position;		theMLParms->theMenu = (PopUpMenu*)D_new(PopUpMenu);	theMLParms->theMenu->Init(theDialog,HOLDER,134,theOwner->type);	theMLParms->oldTilt = theOwner->tilt;	theMLParms->oldAzimuth = theOwner->azimuth;	theMLParms->y_Tilt_Sense = theOwner->y_Tilt_Sense;	theMLParms->oldX = theOwner->position.x;	theMLParms->oldY = theOwner->position.y;	theMLParms->oldZ = theOwner->position.z;				SetItemValue( theDialog,TILTAxis,theOwner->tilt,3);	SetItemValue( theDialog,AZUMAXIS,theOwner->azimuth,3);		SetItemValue( theDialog,SETUPANGLE,theOwner->rotTiltToVer,3);	if(theOwner->y_Tilt_Sense == 1)		SwitchBoolean(theDialog,Y_SENSE,false);	else		SwitchBoolean(theDialog,Y_SENSE,true);	SwitchBoolean(theDialog,SETUP_STAGE,true);		PenMode(patXor);	Identity_Matrix(theOwner->oldAxes);		gCurrentObj->CopyAxesIntoMatrix(theOwner->oldAxes);	theMLParms->oldZone = (Index*)D_new(Index);	theMLParms->oldgvec = (Index*)D_new(Index);	theMLParms->rotVec = (Index*)D_new(Index);		theMLParms->oldIr = gCurrentObj->calcIrrational;	gCurrentObj->theZoneAxis->DoCopy(theMLParms->oldZone);	gCurrentObj->g_Vector->DoCopy(theMLParms->oldgvec);	gCurrentObj->theRotationAxis->DoCopy(theMLParms->rotVec);	theMLParms->rotAng = gCurrentObj->rotationAngle;	theMLParms->offLaueD = gCurrentObj->offLaueDistance;	theMLParms->totalRot = gCurrentObj->totalRot;	theMLParms->beamAzimuth = gCurrentObj->beamAzimuth;	SetItemValue(theDialog,BEAM_H,theMLParms->oldZone->x,5);	SetItemValue(theDialog,BEAM_K,theMLParms->oldZone->y,5);	SetItemValue(theDialog,BEAM_L,theMLParms->oldZone->z,5);	*paramBlock = (Ptr)theMLParms;	HideDItem(theDialog,Y_SENSE);	HideDItem(theDialog,SETUPANGLE);	theOwner->SetFoundation(theDialog,theMLParms);//this sets the OR setup for future reference	/*new 1997*/}void		ML_DoStageObjHit(Ptr	owner,DialogPtr theDialog, short theSelect,	Ptr	paramBlock){	StageObj *theOwner;	Boolean			saveData;	theOwner = (StageObj*)owner;	theOwner->DoStageSwitchDef(theDialog,theSelect,(ML_StageObjParamsPtr)paramBlock,&saveData);	return ;}void		ML_DoStageObjRead(Ptr owner,DialogPtr theDialog,Ptr	paramBlock,Boolean saveData){	ML_StageObjParamsPtr theMLParms;	StageObj*		theOwner;	theMLParms		= (ML_StageObjParamsPtr)paramBlock;	theOwner		= (StageObj*)owner;		theOwner->ReadStageDialog( theDialog,theMLParms,saveData);	theOwner->SetFoundation(0L,0L);/*new 1997*/ 	KillPtr(paramBlock);}