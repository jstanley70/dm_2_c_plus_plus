#include "ML_Real_Lattice.h"#include "ML_Crystal.h"#include	"Diffract_INCs.h"#include	"a_LatticeObject.h"#include "ML_Default.h"#include "ML_Misc_Plot.h"#include "ML_CrystalFace.h"void ML_DoRealLatSetup(Ptr owner,DialogPtr theDialog,Ptr	*thePtr){	LatticeObject*		theOwner;	ML_RealLatParamsPtr theParams;		theOwner 			= (LatticeObject*)owner;		*thePtr = (Ptr)D_NewPtr(sizeof(ML_RealLatParams));	theParams = (ML_RealLatParamsPtr)*thePtr;	theOwner->DoDefSetUp(theDialog, theParams);	DrawDialog(theDialog);}void ML_DoRealLatHit(Ptr	owner,DialogPtr theDialog, short theSelect,	Ptr	thePtr){	ML_RealLatParamsPtr theParams;	Boolean		saveData;	LatticeObject *theOwner;	DialogPtr 	dummy;	dummy = theDialog;//warning	theParams = (ML_RealLatParamsPtr)thePtr;	theOwner 	= (LatticeObject*)owner;	theDialog = theDialog;	theOwner->DoHitLat(theParams, theSelect,&saveData);}void ML_DoRealLatRead(Ptr owner,DialogPtr theDialog,Ptr	thePtr,Boolean saveData){	ML_RealLatParamsPtr theParams;	LatticeObject *theOwner;	theOwner = (LatticeObject*)owner;	theParams = (ML_RealLatParamsPtr)thePtr;		theOwner->DoLatReadDef(theDialog, theParams,saveData);}void  LatticeObject::DoDefSetUp(DialogPtr theDialog,ML_RealLatParamsPtr thePrams){	short i;	short resID = 7100;	thePrams->item[0] = baseCrystal + 1;	thePrams->item[1] = imageType;	thePrams->item[2] = displayType;	thePrams->item[3] = radiusType;		thePrams->oldItem[0] = baseCrystal + 1;	thePrams->oldItem[1] = imageType;	thePrams->oldItem[2] = displayType;	thePrams->oldItem[3] = radiusType;		for(i = 0 ; i <= 3 ; i++){		thePrams->theMenus[i] = (PopUpMenu*)D_new(PopUpMenu);		thePrams->theMenus[i]->Init(theDialog,i + 5,resID + i,thePrams->item[i]);	}	GetDItem(theDialog,13,&gType,&gTheHandle,&gTheRect);	sprintf(gTheText,"%6.2f",scaling);	c2pstr(gTheText);	SetIText(gTheHandle,pTheText);}void	LatticeObject::DoLatReadDef(DialogPtr theDialog,ML_RealLatParamsPtr theParams,Boolean saveData){	short i;	for(i = 0 ; i < 4 ; i++){		if(theParams->item[i] != theParams->theMenus[i]->lastResult)changedFlag = true;		theParams->item[i] = theParams->theMenus[i]->lastResult;		theParams->theMenus[i]->DoClose();	}	if(saveData){		SetORToNewBase(theParams->item[0] - 1);		if(imageType 	!= theParams->item[1])changedFlag = true;		imageType 	= theParams->item[1];				if(displayType 	!= theParams->item[2])changedFlag = true;		displayType = theParams->item[2];				if(radiusType 	!= theParams->item[2])changedFlag = true;		radiusType 	= theParams->item[3];				if(fabs(scaling - GetItemValue(theDialog,13)) > .1) changedFlag = true;		scaling = GetItemValue(theDialog,13);	}	KillPtr((Ptr)theParams);	}Boolean	LatticeObject::DoHitLat(ML_RealLatParamsPtr theParams,short theSelect,Boolean *saveData){	short		i;	switch(theSelect){		case DLOG_ENTER_OR_CR:		case	1:			*saveData = true;			return true;		case -1:		case 2:			*saveData = false;			return true;		case 5:		case 6:		case 7:		case 8:			i = theSelect - 5;			theParams->theMenus[i]->DoPopUp();			break;		default:			break;		case ML_UPDATE_EVT:			//DrawDialog(theDialog);			break;	}		return false;}void	LatticeObject::DoDefine(void)				/* Object Definition method			*/{	Boolean			calculateFlag;	MultiLog*		theMultiLog;	short				n = 0;		theMultiLog	= (MultiLog*)new(MultiLog);	theMultiLog->DoInit(253,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoRealLatSetup,(HitProcPtr)ML_DoRealLatHit,(ReadProcPtr)ML_DoRealLatRead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoBeamORSetup,(HitProcPtr)ML_DoBeamORHit,(ReadProcPtr)ML_DoBeamORRead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[0]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrysFaceSetup,(HitProcPtr)ML_DoCrysFaceHit,(ReadProcPtr)ML_DoCrysFaceRead,(Ptr)theCrystal[0]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoStageObjSetup,(HitProcPtr)ML_DoStageObjHit,(ReadProcPtr)ML_DoStageObjRead,(Ptr)stage);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[1]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrysFaceSetup,(HitProcPtr)ML_DoCrysFaceHit,(ReadProcPtr)ML_DoCrysFaceRead,(Ptr)theCrystal[1]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[2]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrysFaceSetup,(HitProcPtr)ML_DoCrysFaceHit,(ReadProcPtr)ML_DoCrysFaceRead,(Ptr)theCrystal[2]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[3]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrysFaceSetup,(HitProcPtr)ML_DoCrysFaceHit,(ReadProcPtr)ML_DoCrysFaceRead,(Ptr)theCrystal[3]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_SetMiscParam,(HitProcPtr)ML_SwitchMiscParam,(ReadProcPtr)ML_ReadMiscParam,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoDefaultSetup,(HitProcPtr)ML_DoDefaultHit,(ReadProcPtr)ML_DoDefaultRead,(Ptr)this);			calculateFlag = theMultiLog->DoMultiLog();	theMultiLog->DoClose();		if(calculateFlag   && screenPict == NUL  && gMyOffG == 0L){		changedFlag = true;		reSizeFlag = true;		newPictReq = true;/*eliminated line dec 1992*/	} else if(screenPict == NUL  && gMyOffG == 0L){		CloseTheObject(theWindow);	}}void LatticeObject::DoSetUp(void){	DialogPtr 		theDialog;	short			theSelect;	Boolean			quit = false;	Boolean			saveData = false;	ML_RealLatParamsPtr theParams;		theParams =  (ML_RealLatParamsPtr)D_NewPtr(sizeof(ML_RealLatParams));		theDialog	= DM_GetNewDialog(11118,NUL,IN_FRONT);	DoDefSetUp( theDialog, theParams);	while(!quit){		ModalDialog(TheFilterUPP,&theSelect);		switch(theSelect){			case ML_UPDATE_EVT:				BeginUpdate(theDialog);			UpdtDialog(theDialog,theDialog->visRgn);			if(!gAppleEvtsOK){				HiliteOK(theDialog);			}			quit = DoHitLat(theParams,theSelect,&saveData);			EndUpdate(theDialog);			break;			default:			quit = DoHitLat(theParams,theSelect,&saveData);			break;			}			}	DoLatReadDef(theDialog, theParams,saveData);	DM_DisposDialog(&theDialog);			return;}	