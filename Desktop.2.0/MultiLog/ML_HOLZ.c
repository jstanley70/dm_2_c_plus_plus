#include "ML_HOLZ.h"#include "HOLZObj.h"#include	"Diffract_INCs.h"#include "ML_Crystal.h"#include "ML_BeamOrientation.h"#include "ML_OneDis.h"	#include "ML_Elasticity.h"#include "ML_StructFactor.h"#include "ML_Default.h"#include "ML_Misc_Plot.h"void	ML_DoHOLZObjSetup(Ptr	owner,DialogPtr theDialog,Ptr *theParams){	HOLZObj*			theOwner;	theOwner					= (HOLZObj*)owner;	theOwner->SetDefineObj( theDialog);	*theParams = (Ptr)0L;	DrawDialog(theDialog);}void	ML_DoHOLZObjHit(Ptr	owner,DialogPtr theDialog, short theSelect,Ptr theParams){	HOLZObj*		theOwner;	Boolean		saveData;		theOwner		= (HOLZObj*)owner;	theParams		= (Ptr)NUL;             // Eliminates warning;  theParams is required		theOwner->DefineSwitch( theDialog, theSelect,&saveData);}void	ML_DoHOLZObjRead(Ptr owner,DialogPtr theDialog,Ptr theParams,Boolean saveData){	HOLZObj*		theOwner;	theOwner		= (HOLZObj*)owner;	theParams		= (Ptr)NUL; 	theOwner->ReadDefineDialog( theDialog, saveData);}void HOLZObj::SetDefineObj(DialogPtr theDialog){	short i;	double theValue;	for(i = _3_; i < _7_;i++){		GetDItem(theDialog,i,&gType,&gTheHandle,&gTheRect);		SetCtlValue((ControlHandle)gTheHandle,plotFlags[i - _3_]);	}		GetDItem(theDialog,_10_,&gType,&gTheHandle,&gTheRect);	SetCtlValue((ControlHandle)gTheHandle,greyFlag);		GetDItem(theDialog,_11_,&gType,&gTheHandle,&gTheRect);	SetCtlValue((ControlHandle)gTheHandle,curvedLines);				GetDItem(theDialog,_12_,&gType,&gTheHandle,&gTheRect);	SetCtlValue((ControlHandle)gTheHandle,approximateFlag);	theValue = lowOrder;		SetItemValue(theDialog,_7_,(double)theValue,0);		theValue = highOrder;	SetItemValue(theDialog,_8_,(double)theValue,0);			adjustEnergy = SwitchBoolean(theDialog,_13_,!adjustEnergy);}Boolean HOLZObj::DefineSwitch(DialogPtr theDialog,short  theSelect,Boolean *saveData){	switch(theSelect){			case -1:			case 2:				*saveData = false;				return true;			case DLOG_ENTER_OR_CR:			case 1:				*saveData = true;				return true;			case _3_:			case _4_:			case _5_:			case _6_:				SwitchBoolean(theDialog,_3_,true);				SwitchBoolean(theDialog,_4_,true);				SwitchBoolean(theDialog,_5_,true);				SwitchBoolean(theDialog,_6_,true);				SwitchBoolean(theDialog,theSelect,false);				break;			case _10_:			case _11_:			case _12_:			case _13_:								SwitchBoolean(theDialog,theSelect,GetBoolean(theDialog,theSelect));				break;						default:				break;			case ML_UPDATE_EVT:			DrawDialog(theDialog);			break;		}		return false;}void	HOLZObj::ReadDefineDialog(DialogPtr theDialog,Boolean saveData){	short i;		if(saveData){			for(i = _3_ ;i < _7_;i++){				if(plotFlags[i - _3_] != GetBoolean(theDialog,i))changedFlag = true;				plotFlags[i - _3_] = GetBoolean(theDialog,i);			}			if(greyFlag != GetBoolean(theDialog,_10_))newPictReq = true;			greyFlag = GetBoolean(theDialog,_10_);						if(curvedLines != GetBoolean(theDialog,_11_))newPictReq = true;			curvedLines = GetBoolean(theDialog,_11_);						if(approximateFlag != GetBoolean(theDialog,_12_))newPictReq = true;				approximateFlag = GetBoolean(theDialog,_12_);			if(adjustEnergy != GetBoolean(theDialog,_13_))changedFlag = true;				adjustEnergy 	= GetBoolean(theDialog,_13_);			if(lowOrder != GetItemValue(theDialog,_7_))newPictReq = true;			if(lowOrder < GetItemValue(theDialog,_7_))changedFlag = true;			lowOrder = GetItemValue(theDialog,_7_);						if(highOrder != GetItemValue(theDialog,_8_))newPictReq = true;			if(highOrder > GetItemValue(theDialog,_8_))changedFlag = true;			highOrder = GetItemValue(theDialog,_8_);				DoDefineOR( theDialog,false,_3_);		}		}void	HOLZObj::DoDefine(void){	Boolean			calculateFlag;	MultiLog*		theMultiLog;	short				n = 0;		theMultiLog	= (MultiLog*)new(MultiLog);	theMultiLog->DoInit(256,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoHOLZObjSetup,(HitProcPtr)ML_DoHOLZObjHit,(ReadProcPtr)ML_DoHOLZObjRead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoBeamESetup,(HitProcPtr)ML_DoBeamEHit,(ReadProcPtr)ML_DoBeamERead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoBeamORSetup,(HitProcPtr)ML_DoBeamORHit,(ReadProcPtr)ML_DoBeamORRead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[0]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoStageObjSetup,(HitProcPtr)ML_DoStageObjHit,(ReadProcPtr)ML_DoStageObjRead,(Ptr)stage);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[1]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[2]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[3]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_SetPlotParam,(HitProcPtr)ML_SwitchPlotParam,(ReadProcPtr)ML_ReadPlotParam,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_SetMiscParam,(HitProcPtr)ML_SwitchMiscParam,(ReadProcPtr)ML_ReadMiscParam,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoDefaultSetup,(HitProcPtr)ML_DoDefaultHit,(ReadProcPtr)ML_DoDefaultRead,(Ptr)this);		calculateFlag = theMultiLog->DoMultiLog();	theMultiLog->DoClose();		if(calculateFlag    && screenPict == NUL  && gMyOffG == 0L){		changedFlag = true;		reSizeFlag = true;		newPictReq = true;/*eliminated line dec 1992*/	} else if(screenPict == NUL  && gMyOffG == 0L){		CloseTheObject(theWindow);	}	return;}void  HOLZObj::DoDefineSetUp(void){	DialogPtr 		theDialog;	short			theSelect;	Boolean			quit = false;	Boolean			saveData;	theDialog	= DM_GetNewDialog(HOLZDEFINE_OBJ,NUL,IN_FRONT);	SetDefineObj( theDialog);	while(!quit){		ModalDialog(TheFilterUPP,&theSelect);		switch(theSelect){			case ML_UPDATE_EVT:				BeginUpdate(theDialog);			UpdtDialog(theDialog,theDialog->visRgn);			if(!gAppleEvtsOK){				HiliteOK(theDialog);			}			quit = DefineSwitch( theDialog, theSelect,&saveData);			EndUpdate(theDialog);			break;			default:			quit = DefineSwitch( theDialog, theSelect,&saveData);			break;			}					}		if(saveData){		ReadDefineDialog( theDialog, saveData);	}  	DM_DisposDialog(&theDialog);	return;}