#include"Diffract_INCs.h"#include "ML_PlotSetUp.h"#include "ML_Misc_Plot.h"void	ML_SetMiscParam(Ptr	owner,DialogPtr theDialog,Ptr *theParams){	DiffractObject*			theOwner;	ML_SetPlotParamsPtr		theP;	theOwner				= (DiffractObject*)owner;		theP = (ML_SetPlotParamsPtr)D_NewPtr(sizeof(ML_SetPlotParams));	*theParams = (Ptr)theP;	theOwner->SetUpMiscParameters( theDialog,theP);}void	ML_SwitchMiscParam(Ptr	owner,DialogPtr theDialog, short theSelect,Ptr theParams){	DiffractObject*		theOwner;	ML_SetPlotParamsPtr theP;	Boolean				saveData;		theP = (ML_SetPlotParamsPtr)theParams;		theOwner		= (DiffractObject*)owner;	theOwner->SwitchMiscPlotParameters( theDialog, theSelect,theP,&saveData);}void	ML_ReadMiscParam(Ptr owner,DialogPtr theDialog,Ptr thePtr,Boolean saveData){	DiffractObject*		theOwner;	ML_SetPlotParamsPtr    theParams;	theParams = (ML_SetPlotParamsPtr)thePtr;	theOwner		= (DiffractObject*)owner;	theOwner->ReadMiscParameters( theDialog,theParams, saveData);	}void DiffractObject::SetUpMiscParameters(DialogPtr theDialog,ML_SetPlotParamsPtr thePtr){	if(g_Hex_Four)		thePtr->lastSelect = 5;	else		thePtr->lastSelect = 6;	GetDItem(theDialog,thePtr->lastSelect,&gType,&gTheHandle,&gTheRect);	SetCtlValue((ControlHandle)gTheHandle,1);	SetItemValue( theDialog,10,delAngle,2);	if(g_Monitor)		thePtr->lastSelect_M = 7;	else		thePtr->lastSelect_M = 8;	GetDItem(theDialog,thePtr->lastSelect_M,&gType,&gTheHandle,&gTheRect);	SetCtlValue((ControlHandle)gTheHandle,1);		thePtr->linkingMenu = (PopUpMenu*)D_new(PopUpMenu);	thePtr->linkingMenu->  Init  ( theDialog,9,136,linking + 1);	}void DiffractObject::ReadMiscParameters(DialogPtr theDialog,ML_SetPlotParamsPtr thePtr,Boolean saveData){	if(saveData){		if(linking != thePtr->linkingMenu->lastResult - 1)gCurrentObj->changedFlag = true;		linking = thePtr->linkingMenu->lastResult - 1;		if(g_Hex_Four != GetBoolean(theDialog,5)) newPictReq = true;		if(GetBoolean(theDialog,5))g_Hex_Four = true;		else			g_Hex_Four = false;		if(g_Monitor != GetBoolean(theDialog,7)) newPictReq = true;		if(GetBoolean(theDialog,7))g_Monitor = true;		else			g_Monitor = false;		delAngle = GetItemValue( theDialog,10);	}	thePtr->linkingMenu->DoClose();	KillPtr(thePtr);}Boolean DiffractObject::SwitchMiscPlotParameters(DialogPtr theDialog,short theSelect,ML_SetPlotParamsPtr thePr,Boolean *saveData){	switch(theSelect){			case -1:			case 2:							*saveData = false;				return true;			case DLOG_ENTER_OR_CR:			case 1:				*saveData = true;				return true;			case 5:				SwitchBoolean(theDialog,5,false);				SwitchBoolean(theDialog,6,true);				break;			case 6:				SwitchBoolean(theDialog,5,true);				SwitchBoolean(theDialog,6,false);				break;			case 7:				SwitchBoolean(theDialog,7,false);				SwitchBoolean(theDialog,8,true);				break;			case 8:				SwitchBoolean(theDialog,7,true);				SwitchBoolean(theDialog,8,false);				break;			case 9:				thePr->linkingMenu->DoPopUp  ();			break;			case 11:							{				Point		thePoint;				RGBColor	newColor;				RGBColor	**aColor;								thePoint.h = thePoint.v = 0;				if(GetColor(thePoint,"\pSelect Background Color",&backgroundColor,&newColor)){										backgroundColor = newColor;										InvertColor		(&newColor);					SetEntryColor	(thePalette,14,&backgroundColor);					SetEntryColor	(thePalette,15,&newColor);										if(theWindow != 0L)						ActivatePalette(theWindow);										SetObjectDrawTransferMode();					SetTheCursor(WATCH_CURSOR);										DMBackColor		(BACKGROUND_COLOR);					DMForeColor		(COMPLEMENT_COLOR);										aColor 		= 	(RGBColor**)GetResource('COLR',504);					**aColor 	= 	backgroundColor;					ChangedResource	((Handle)aColor);					WriteResource	((Handle)aColor);					ReleaseResource	((Handle)aColor);									}				DrawDialog(theDialog);			}			break;		default:			break;					}		return false;}void DiffractObject::SetMiscParameters(void){	DialogPtr 	theDialog;	Boolean	quit = false;	Boolean	saveData;	ML_SetPlotParamsPtr thePtr;	short			theSelect;			theDialog	= DM_GetNewDialog(11120,NUL,IN_FRONT);	ML_SetMiscParam((Ptr)this, theDialog,(Ptr*)&thePtr);		while(!quit){		ModalDialog(TheFilterUPP,&theSelect);		switch(theSelect){			case ML_UPDATE_EVT:				BeginUpdate(theDialog);			UpdtDialog(theDialog,theDialog->visRgn);			if(!gAppleEvtsOK){				HiliteOK(theDialog);			}			quit = SwitchMiscPlotParameters( theDialog, theSelect, thePtr,&saveData);			EndUpdate(theDialog);			break;			default:			quit = SwitchMiscPlotParameters( theDialog, theSelect, thePtr,&saveData);			break;			}	}	ReadMiscParameters( theDialog, thePtr, saveData);		DM_DisposDialog(&theDialog);}