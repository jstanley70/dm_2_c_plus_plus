#include "OneDisObj.h"#include "ML_OneDis.h"#include	"Diffract_INCs.h"#include "ML_Crystal.h"#include "ML_BeamOrientation.h"#include "ML_OneDis.h"	#include "ML_Elasticity.h"#include "ML_StructFactor.h"#include "ML_Default.h"#include "ML_Misc_Plot.h"void	ML_DoOneDisObjSetup(Ptr	owner,DialogPtr theDialog,Ptr *theParams){	OneDisObj*			theOwner;	ML_OneDisParamsPtr  theP;	theOwner					= (OneDisObj*)owner;	theP = (ML_OneDisParamsPtr)D_NewPtr(sizeof(ML_OneDisParams));	*theParams =  (Ptr)theP;	theOwner->SetDefineObjDE( theDialog,theP);	DrawDialog(theDialog);}void	ML_DoOneDisObjHit(Ptr	owner,DialogPtr theDialog, short theSelect,Ptr theParams){	OneDisObj*		theOwner;	Boolean		saveData;	ML_OneDisParamsPtr  theP;		theOwner		= (OneDisObj*)owner;	theP			=	(ML_OneDisParamsPtr)theParams;	theOwner->DefineSwitchDE( theDialog,theP, theSelect,&saveData);}void	ML_DoOneDisObjRead(Ptr owner,DialogPtr theDialog,Ptr theParams,Boolean saveData){	OneDisObj*		theOwner;	theOwner		= (OneDisObj*)owner;	theOwner->ReadDefineDialogDE( theDialog, saveData);	KillPtr((Ptr)theParams);	}void OneDisObj::DoSetUp(void){	DialogPtr 		theDialog;	short			theSelect;	Boolean			quit = false;	Boolean			saveData = false;	ML_OneDisParamsPtr theP;		theP =  (ML_OneDisParamsPtr)D_NewPtr(sizeof(ML_OneDisParams));	theDialog	= DM_GetNewDialog(305,NUL,IN_FRONT);	SetDefineObjDE( theDialog,theP);	while(!quit){		ModalDialog(TheFilterUPP,&theSelect);		switch(theSelect){			case ML_UPDATE_EVT:				BeginUpdate(theDialog);			UpdtDialog(theDialog,theDialog->visRgn);			if(!gAppleEvtsOK){				HiliteOK(theDialog);			}			quit = DefineSwitchDE( theDialog,theP, theSelect,&saveData);			EndUpdate(theDialog);			break;			default:			quit = DefineSwitchDE( theDialog,theP, theSelect,&saveData);			break;			}			}	ReadDefineDialogDE( theDialog, saveData);	KillPtr((Ptr)theP);	DM_DisposDialog(&theDialog);		return;}void OneDisObj::SetDefineObjDE(DialogPtr theDialog,ML_OneDisParamsPtr theParams){		DefineSetUp(theDialog);	sprintf(gTheText,"Define Orientation %d",number_Beams);	GetDItem(theDialog,_14_,&gType,&gTheHandle,&gTheRect);	SetCTitle((ControlHandle)gTheHandle,c2pstr(gTheText));	theParams->lastSelect = _3_ + baseCrystal;	theParams->oldCrystal = baseCrystal;}Boolean OneDisObj::DefineSwitchDE(DialogPtr theDialog,ML_OneDisParamsPtr thePtr,short theSelect,Boolean *saveData){	Boolean theFlag;	switch(theSelect){			case -1:			case 2:				*saveData = true;					return true;			case 1:				*saveData = true;					return true;			case _3_:			case _4_:			case _5_:			case _6_:				SwitchBoolean(theDialog,thePtr->lastSelect,true);				SwitchBoolean(theDialog,theSelect,false);				thePtr->lastSelect = theSelect;				break;			case _8_:				theFlag = GetBoolean(theDialog,theSelect);				theFlag = SwitchBoolean(theDialog,theSelect,theFlag);				if(theFlag){					SetItemValue(theDialog,_7_,AnomalGuess(),4);				}				break;			case _9_:				theFlag = GetBoolean(theDialog,theSelect);				theFlag = SwitchBoolean(theDialog,theSelect,theFlag);				break;						case _10_:				thePtr->oldCrystal = baseCrystal;				baseCrystal = thePtr->lastSelect - _3_;				GetCurrentBeamValues(theDialog);				InsertCurrentBeam();								number_Beams++;				sprintf(gTheText,"Define Orientation %d",number_Beams);				GetDItem(theDialog,_14_,&gType,&gTheHandle,&gTheRect);				SetCTitle((ControlHandle)gTheHandle,c2pstr(gTheText));							CheckBeamsMem(1);				if(!ResetBeam(number_Beams))					AddBeams(theDialog,true);				DefineSetUp(theDialog);					baseCrystal = thePtr->oldCrystal;				break;			case _11_:				if(number_Beams < 2) break;				GetCurrentBeamValues(theDialog);				InsertCurrentBeam();				number_Beams--;				sprintf(gTheText,"Define Orientation %d",number_Beams);				GetDItem(theDialog,_14_,&gType,&gTheHandle,&gTheRect);				SetCTitle((ControlHandle)gTheHandle,c2pstr(gTheText));							ResetBeam(number_Beams);				GetVectors();				DefineSetUp(theDialog);									break;			case 15:				theFlag = GetBoolean(theDialog,theSelect);				theFlag = SwitchBoolean(theDialog,theSelect,theFlag);				break;			case 16:				DoDefineOR( theDialog,true,_3_);				break;			default:				break;			case ML_UPDATE_EVT:			DrawDialog(theDialog);			break;		}		*saveData = false;		return false;}void  OneDisObj::ReadDefineDialogDE(DialogPtr theDialog,Boolean saveData){		DoDefineOR( theDialog,false,_3_);	if(saveData){		if(macroFlag != GetBoolean(theDialog,_13_))changedFlag = true;		macroFlag = GetBoolean(theDialog,_13_);		GetCurrentBeamValues(theDialog);		InsertCurrentBeam();	}	}void OneDisObj::DoDefine(void){		Boolean			calculateFlag;	MultiLog*		theMultiLog;	short				n = 0;		theMultiLog	= (MultiLog*)new(MultiLog);	theMultiLog->DoInit(254,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoOneDisObjSetup,(HitProcPtr)ML_DoOneDisObjHit,(ReadProcPtr)ML_DoOneDisObjRead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoBeamESetup,(HitProcPtr)ML_DoBeamEHit,(ReadProcPtr)ML_DoBeamERead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoBeamORSetup,(HitProcPtr)ML_DoBeamORHit,(ReadProcPtr)ML_DoBeamORRead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoFoilSetup,(HitProcPtr)ML_DoFoilHit,(ReadProcPtr)ML_DoFoilRead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[0]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoDisDefSetup,(HitProcPtr)ML_DoDislocDefHit,(ReadProcPtr)ML_DoDislocDefRead,(Ptr)this);		theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoStageObjSetup ,(HitProcPtr)ML_DoStageObjHit,(ReadProcPtr)ML_DoStageObjRead,(Ptr)stage);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[1]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[2]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrystalSetup,(HitProcPtr)ML_DoCrystalHit,(ReadProcPtr)ML_DoCrystalRead,(Ptr)theCrystal[3]);		theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrysElastSetup,(HitProcPtr)ML_DoCrysElastHit,(ReadProcPtr)ML_DoCrysElastRead,(Ptr)theCrystal[0]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrysElastSetup,(HitProcPtr)ML_DoCrysElastHit,(ReadProcPtr)ML_DoCrysElastRead,(Ptr)theCrystal[1]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrysElastSetup,(HitProcPtr)ML_DoCrysElastHit,(ReadProcPtr)ML_DoCrysElastRead,(Ptr)theCrystal[2]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoCrysElastSetup,(HitProcPtr)ML_DoCrysElastHit,(ReadProcPtr)ML_DoCrysElastRead,(Ptr)theCrystal[3]);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoSFSetup,(HitProcPtr)ML_DoSFHit,(ReadProcPtr)ML_DoSFRead,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_SetMiscParam,(HitProcPtr)ML_SwitchMiscParam,(ReadProcPtr)ML_ReadMiscParam,(Ptr)this);	theMultiLog->AssignFunction(n++,(SetupProcPtr)ML_DoDefaultSetup,(HitProcPtr)ML_DoDefaultHit,(ReadProcPtr)ML_DoDefaultRead,(Ptr)this);		calculateFlag = theMultiLog->DoMultiLog();	theMultiLog->DoClose();		if(calculateFlag  && screenPict == NUL  && gMyOffG == 0L){		changedFlag = true;		reSizeFlag = true;		newPictReq = true;/*eliminated line dec 1992*/	} else if(screenPict == NUL  && gMyOffG == 0L){		CloseTheObject(theWindow);	}	return;}