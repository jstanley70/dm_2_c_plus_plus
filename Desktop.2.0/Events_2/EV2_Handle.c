#include "EV2_Handle.h"#include	"Diffract_INCs.h"void	D_ExpandMemory(Handle* bottomDataHandle,long *data_Count,long *data_Length,long data_Size,long data_Expand)	/*  Object memory expansion			*/{	Size	theSize;	Boolean	locked;			char	cMemTags;	Handle theDataHandle;	theDataHandle = *bottomDataHandle;	cMemTags = HGetState(theDataHandle);	if(MemError() != 0){		D_Debug_Message(19);		return;	}	if((cMemTags & 0x80) != 0){		locked = true;		D_HUnlock(theDataHandle);	} else {		locked = false;	}		theSize	=	GetHandleSize(theDataHandle);	/*Added for V2.0*/	if(*data_Count - *data_Length > 0 ){		long j;		j = (*data_Count - *data_Length);		*data_Length = *data_Count;		theSize	+=	(j * data_Size);		SetHandleSize(theDataHandle,theSize);		*bottomDataHandle = theDataHandle;		if(MemError() != noErr){			WarnUser(1);			gNoBreak = false;			if(*data_Count < 0)				*data_Count = 0;			if(locked)				D_HLock(theDataHandle);			return;		}	}	theSize	+=	(data_Expand * data_Size);	SetHandleSize(theDataHandle,theSize);	*bottomDataHandle = theDataHandle;	if(MemError() != noErr){		WarnUser(1);		data_Count -= data_Expand;		gNoBreak = false;		if(*data_Count < 0)			*data_Count = 0;		if(locked)			D_HLock(theDataHandle);		return;	}	*data_Length	+= data_Expand;	if(locked)		D_HLock(theDataHandle);}void qHandlesort(void** theDataHandle,long total,long sizeOf,_compare_function/*__cmp_func_Cmpfun**/ theFunction){	Ptr thePtr;	D_HLock(theDataHandle);	thePtr = (Ptr)*theDataHandle;	qsort(thePtr,total,sizeOf,(_compare_function/*__cmp_func_Cmpfun**/) theFunction);	D_HUnlock(theDataHandle);}