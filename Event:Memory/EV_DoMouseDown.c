//s.Jim:Event/Memory:EV_DoMouseDown.c#include	"Diffract_INCs.h"void	DoContent(Point,DiffractObject*,Boolean);pascal	void	DoScrollBar(ControlHandle,short);void DoMouseDown(EventRecord *theEvent){	short 			windowCode,h,v;	long 			result;	WindowPtr 		theWindow;	Rect 			theRect;	DiffractObject	*ownerObj;	static Point	lastPoint;	static long		lastClickTime;	Boolean 		isMember;	windowCode 	= FindWindow(theEvent->where,&theWindow);	if(windowCode <= inSysWindow){		ownerObj	= gCurrentObj;		ownerObj->SetTheCursor(0);	} else {		ownerObj	= (DiffractObject*)GetWRefCon(theWindow);	}		if(IsValidObj(ownerObj)){		isMember = true;	} else {		isMember = false;	}		if(windowCode == inDrag && isMember){		ownerObj->SetTheCursor(0);	}			switch(windowCode){		case inMenuBar:			if(theEvent->modifiers & shiftKey){				gShifted = true;			} else {				gShifted = false;			}			result = MenuSelect(theEvent->where);						if(!SystemEdit(LoWord(result) - 1) && isMember){ 				HiliteMenu(0);				if(RING_D_SPACING == gCurrentObj->functionID)				{					//((SADObj*)gCurrentObj)->textBox->DoClose();				}				if(gCurrentObj->functionID != -1 && gCurrentObj->newPictEnable ){				 gCurrentObj->newPictReq = true;				}else if(gCurrentObj->functionID != -1 && gCurrentObj->gMyOffG){					gCurrentObj->refreshFlag = true;				}									gCurrentObj->functionID = -1;				gCurrentObj->newPictEnable = false;				if(gCurrentObj->variSize){					if(gCurrentObj->rulerHeight != 0 && gCurrentObj->theRuler != NUL){						gCurrentObj->theRuler->ClearPrompt();						gCurrentObj->theRuler->ClearHelp();					}					//InvalRect(&gCurrentObj->theVisRect);//bloch				}				gCurrentObj->DoMenu(result);			}			break;		case inSysWindow:			SystemClick(theEvent,theWindow);			break;					case inGoAway:			if(TrackGoAway(theWindow,theEvent->where)){				if(theEvent->modifiers & optionKey){					CloseAllObjects();				} else {					CloseTheObject(theWindow);				}				return;			}			break;					case inGrow:			theRect = gScreenSize;			InsetRect(&theRect,4,4);			result = GrowWindow(theWindow,theEvent->where,&theRect);			if(result == NUL)				break;			h 				= LoWord(result);			v 				= HiWord(result);			theRect 		= theWindow->portRect;			theRect.right 	= theWindow->portRect.right;	/*  Erase Grow Box	*/			theRect.left	= theRect.right - 16;			theRect.bottom	= theWindow->portRect.bottom;			theRect.top 	= theRect.bottom - 16;			dm_EraseRect(&theRect);			InvalRect(&theRect);					SizeWindow(theWindow,h,v,true);			if(isMember)				ownerObj->DoResize();			break;					case inDrag:VerifyObjects();				theRect = gScreenSize;			InsetRect(&theRect,4,4);			DragWindow(theWindow,theEvent->where,&theRect);VerifyObjects();				if(!(theEvent->modifiers & cmdKey))				SetTopWindow(theWindow);			break;					case inContent:						if(theWindow != gTopWindow){				SelectWindow(theWindow);				SetTopWindow(theWindow);			} else {				long	diff;				double x,y,r;				if(theEvent->modifiers & shiftKey){					gShifted = true;				} else {					gShifted = false;				}				if(labs(TickCount() - lastClickTime) <= LMGetDoubleTime()){					diff = DeltaPoint(theEvent->where,lastPoint);					x = abs(HiWord(diff));					y = abs(LoWord(diff));					r = x * x + y * y;										if(r < 19  && isMember){						DoContent(theEvent->where,ownerObj,true);						lastClickTime = TickCount();						lastPoint = theEvent->where;						break;					}				}								if(isMember)					DoContent(theEvent->where,ownerObj,false);			}			lastClickTime = TickCount();			lastPoint = theEvent->where;							break;				case inZoomIn:		/* volume 4 pg 51 */		case inZoomOut:					if(TrackBox(theWindow,theEvent->where,windowCode)){				SetPort(theWindow);				D_SetClip(gUpdateAll);				theRect = theWindow->portRect;				dm_EraseRect(&(theWindow->portRect));				InvalRect(&(theWindow->portRect));				ZoomWindow(theWindow,windowCode,true);				if(isMember){					ownerObj->DoResize();					dm_EraseRect(&(ownerObj->theVisRect));					InvalRect(&(ownerObj->theVisRect));				}			}			break;		default:			break;	}}void		DoContent(Point	thePoint,DiffractObject*	ownerObj,Boolean dblClickFlag){	ControlHandle	theControl;	ScrollBar		*theScrollBar;	Boolean			flag = false;	WindowPtr		currentWindow;			currentWindow = gTopWindow;		if(ownerObj->isCalculating)		return;		GlobalToLocal(&thePoint);	if(ownerObj->variSize){  		if(FindControl(thePoint,gTopWindow,&theControl)){			theScrollBar = (ScrollBar*)GetCRefCon(theControl);			if(IsValidObj(theScrollBar)){				if(ownerObj->theTextSystem)/*dec 9 1992 */					ownerObj->theTextSystem->textObject->DeactivateAll();/*dec 1992 */				theScrollBar->DoScroll(thePoint);								return;			}		}	}		D_SetClip(ownerObj->picUpdateRgn);	ownerObj->onScreen = true;		if(dblClickFlag){		ownerObj->DoDblClick(thePoint);		dblClickFlag = false;	} else {		ownerObj->DoContent(thePoint);	}	ownerObj->onScreen = false;		if(gTopWindow == currentWindow)		D_SetClip(ownerObj->eventRgn);}									