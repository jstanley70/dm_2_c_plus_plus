//s.Jim:Event/Memory:EV_Watch.c#include	"Diffract_INCs.h"#define		THE_EVT_MASK	(updateMask | activMask | app4Mask)void	WatchInstall(void){	short i;		for(i = 700 ; i <= 707 ; i++){		gTheHandle = GetResource('CURS',i);		gTheCursors[i - 700] = **((Cursor**)gTheHandle);		ReleaseResource(gTheHandle);	}		gWatchFunction 				= STOP_WATCH;		//WatchVBL.qType				= vType;	//WatchVBL.vblAddr			= NewVBLProc(Watch);	//WatchVBL.vblCount			= 4;	//WatchVBL.vblPhase			= 0;	//VInstall((QElemPtr)&WatchVBL);}void	WatchRemove(void){		//VRemove((QElemPtr)&WatchVBL);}void	StartWatch(void){	gNoBreak			= true;	gWatchFunction 		= START_WATCH;	//WatchVBL.vblCount 	= 4;	gWaitTime 			= 1;}void	StopWatch(void){	CursHandle theHandle;	gWatchFunction = STOP_WATCH;	theHandle	= GetCursor(STOP_WATCH);	if(theHandle){		SetCursor(*theHandle);		ReleaseResource((Handle)theHandle);	}else{		InitCursor();	}	FlushEvents(everyEvent,0);}	void	Watch(void){	static 		short 	count;	short				delayTime;	long				oldA5;	//EventRecord			theEvent;		oldA5 = SetCurrentA5();		delayTime = 30;		switch(gWatchFunction){		case STOP_WATCH:			count 		= 0;			delayTime 	= 32767;			break;					case START_WATCH:							SetCursor(&gTheCursors[count++]);				if(count > 7)					count = 0;						break;					case TRIG_WATCH:							gWatchFunction 	= START_WATCH;				gWatchtrigger 	= false;				gWaitTime 		= 1;				FlushEvents(everyEvent,0);						break;					default:			break;	}	//WatchVBL.vblCount = delayTime;	oldA5 = SetA5(oldA5);}void	CheckWatch(){	short	count;		for(count = 1 ; count <= 10 ; count++)		SysBeep(30);}void	AllowBackground(void)		// Disabled backgrounding{	GrafPtr		theOldPort;	EventRecord	theEvent;	return;	if(gWatchtrigger){		if(gInBackground){			MiniSwitchboard();			gWaitTime = 1;			while(OSEventAvail(everyEvent,&theEvent)) {				MiniSwitchboard();			}			gWaitTime = 10;						GetPort(&theOldPort);			SetPort(gCurrentObj->theWindow);			InvertRect(&gCalcRect);			SetPort(theOldPort);						gWatchtrigger = false;		//WatchVBL.vblCount = 10;		}	}}