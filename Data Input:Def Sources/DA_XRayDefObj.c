//Macintosh HD:CodeWarriorª DR/3 Gold Ä:Metrowerks  C/C++ Ä:Projects:D.M. v2.0:Sources.Jim:Data Input/Def Sources:DA_XRayDefObj.c#include	"Diffract_INCs.h"#include 	"defineElectronObj.h"#include 	"XRayDefObj.h"void XRayDefObj::DoClose(void){	inherited::DoClose();}void	XRayDefObj::DoRead(DialogPtr theDialog,Ptr theParams,Boolean saveData,Boolean closeDialog){	if(saveData){		if(fabs(maxEnergy - GetItemValue(theDialog,26)) > .01)			((DiffractObject*)theOwner)->changedFlag = true;		maxEnergy = GetItemValue(theDialog,26);			}	inherited::DoRead( theDialog, theParams, saveData,closeDialog);	KillDialog();}void XRayDefObj::DoInit(long	owner){	inherited::DoInit(owner);		wavelength = 1.541838;	energy = 12.4 / wavelength;	maxEnergy = 25.;	charWaveLength 	= 1;}float XRayDefObj::SetVOLTAGE(void){	return wavelength;}void  XRayDefObj::SetFluff(DialogPtr theDialog,Boolean *cameraFlag)/*change here, Mar 1995*/{	SetLengthButton(theDialog,cameraFlag);	ShowDItem(theDialog,24);	ShowDItem(theDialog,25);	ShowDItem(theDialog,26);	SetItemText(theDialog,VOLTLABEL,"\pwavelength");	SetItemText(theDialog,VOLTUNITS,"\p");	sprintf(gTheText,"%5.2f",maxEnergy);	c2pstr(gTheText);	SetItemText(theDialog,26,pTheText);	GetDItem(theDialog,LENGTHBUTTON,&gType,&gTheHandle,&gTheRect);	sprintf(gTheText,"Camera Length");		SetCTitle((ControlHandle)gTheHandle,c2pstr(gTheText));	GetDItem(theDialog,VOLTAGE,&gType,&gTheHandle,&gTheRect);	sprintf(gTheText,"%5.4f",wavelength);		GetDItem		(theDialog,24,&gType,&gTheHandle,&gTheRect);	sprintf			(gTheText,"Max. Energy");	SetIText		(gTheHandle,c2pstr(gTheText));	}void	XRayDefObj::InitPopUpMenu(DialogPtr theDialog,PopUpMenu *popUpMenu){	cuMenu = GetMenu(21);	coMenu = GetMenu(22);	crMenu = GetMenu(23);	feMenu = GetMenu(24);	moMenu = GetMenu(25);	popUpMenu->Init(theDialog,POPUPMENUKV,108,charWaveLength);	InsertMenu(cuMenu,-1);	InsertMenu(coMenu,-1);	InsertMenu(crMenu,-1);	InsertMenu(feMenu,-1);	InsertMenu(moMenu,-1);	GetDItem(theDialog,VOLTAGE,&gType,&gTheHandle,&gTheRect);	sprintf(gTheText,"%5.4f",wavelength);	SetIText(gTheHandle,c2pstr(gTheText));}void  XRayDefObj::DoPopMenuComplete(DialogPtr theDialog,PopUpMenu *popUpMenu){	long theXType;		theXType = popUpMenu->DoPopUp();	if(LoWord(theXType)){		theXElement = theXType;		charWaveLength = (HiWord(theXElement) - 20);	}	popUpMenu->lastResult = HiWord(theXElement) - 20;	popUpMenu->SetPopUp();	SetNewRay();	GetDItem(theDialog,VOLTAGE,&gType,&gTheHandle,&gTheRect);	sprintf(gTheText,"%5.4f",wavelength);	SetWaveAndEnergy(wavelength);	SetIText(gTheHandle,c2pstr(gTheText));}void XRayDefObj::KillDialog(void){	DeleteMenu(21);	DeleteMenu(22);	DeleteMenu(23);	DeleteMenu(24);	DeleteMenu(25);//	DeleteMenu(108);	ReleaseResource((Handle)cuMenu);	ReleaseResource((Handle)coMenu);	ReleaseResource((Handle)crMenu);	ReleaseResource((Handle)moMenu);	ReleaseResource((Handle)feMenu);}void  XRayDefObj::SetWaveAndEnergy(float theValue){	wavelength = theValue;	if(wavelength == 0) {energy = 0.0; return;}	energy = 12.4 / wavelength;	return;}void XRayDefObj::SetNewRay(void){	short theMenu,theResult;	theMenu = HiWord(theXElement) - 20;	theResult = LoWord(theXElement);	switch(theMenu){		case 1:			switch(theResult)			{				case 1:					wavelength = 1.541838;					break;				case 2:					wavelength = 1.544390;					break;				case 3:					wavelength = 1.540562;					break;				case 4:					wavelength = 1.392218;					break;				default:					break;			}			break;		case 2:			switch(theResult)			{				case 1:					wavelength = 1.79026;					break;				case 2:					wavelength = 1.79285;					break;				case 3:					wavelength = 1.788965;					break;				case 4:					wavelength = 1.62079;					break;				default:					break;			}			break;		case 3:			switch(theResult)			{				case 1:					wavelength = 2.291;					break;				case 2:					wavelength = 2.293606;					break;				case 3:					wavelength = 2.28970;					break;				case 4:					wavelength = 2.08487;					break;				default:					break;			}			break;		case 4:			switch(theResult)			{				case 1:					wavelength = 1.937355;					break;				case 2:					wavelength = 1.93998;					break;				case 3:					wavelength = 1.936042;					break;				case 4:					wavelength = 1.75661;					break;				default:					break;			}			break;		case 5:			switch(theResult)			{				case 1:					wavelength = .710737;					break;				case 2:					wavelength = .71359;					break;				case 3:					wavelength = .7093;					break;				case 4:					wavelength = .632288;					break;				default:					break;			}			break;		default:			break;	}}void XRayDefObj::ReadBeam(void){	inherited::ReadBeam();}void XRayDefObj::WriteBeam(void){	inherited::WriteBeam();}